var NODEJS="undefined"!=typeof module&&module.exports&&"function"==typeof require&&require("https");if(function(){function e(e){var t="("+(e=e||{}).status+") "+e.responseText;try{JSON.parse(e.responseText).error.code.split(",")[0],t="("+e.status+") "+JSON.parse(e.responseText).error.message.value}catch(t){r&&console.warn("Unable to parse jqXHR response:\n"+e.responseText)}return t}function t(){return new Promise(function(e,t){UpdateFormDigest(_spPageContextInfo.webServerRelativeUrl,10),e()})}var r=!1,a={0:"List",1:"Library",3:"Discussion Board",4:"Survey",5:"Issue"},i={0:"None",1:"User",2:"Distribution List",4:"Security Group",8:"SharePoint Group",15:"All"},n={baseUrl:"..",busySpinnerHtml:'<div class="sprlib-spinner"><div class="sprlib-bounce1"></div><div class="sprlib-bounce2"></div><div class="sprlib-bounce3"></div></div>',cache:!1,cleanColHtml:!0,currencyChar:"$",language:"en",maxRetries:2,maxRows:1e3,metadata:!1,nodeCookie:"",nodeEnabled:!0,nodeServer:"",retryAfter:1e3},s=/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/i,o=0;this.sprLib={},sprLib.version="1.7.0-beta-20180331",sprLib.baseUrl=function(e){if("string"!=typeof e||""==e||!e)return n.baseUrl;n.baseUrl=e.replace(/\/+$/,""),r&&console.log("APP_OPTS.baseUrl = "+n.baseUrl)},sprLib.list=function(e){function t(){return new Promise(function(e,t){sprLib.rest({url:o+"?$select=ListItemEntityTypeFullName"}).then(function(r){r&&Array.isArray(r)&&1==r.length?e({type:r[0].ListItemEntityTypeFullName}):t("Invalid result!")}).catch(function(e){t(e)})})}var a={},o="_api/lists",l=(e=e||{}).requestDigest||("undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null);if(e.guid&&(e.name=e.guid),e&&"string"==typeof e)o+=s.test(e)?"(guid'"+e+"')":"/getbytitle('"+e.replace(/\s/gi,"%20")+"')";else{if(!(e&&"object"==typeof e&&Object.keys(e).length>0&&e.name))return console.error("ERROR: A 'listName' or 'listGUID' is required! EX: `sprLib.list('Employees')` or `sprLib.list({ name:'Employees' })`"),console.error("ARGS:"),console.error(e),null;o=e.baseUrl?e.baseUrl.replace(/\/+$/,"")+"/_api/lists":o,o+=s.test(e.name)?"(guid'"+e.name+"')":"/getbytitle('"+e.name.replace(/\s/gi,"%20")+"')"}return a.cols=function(){return new Promise(function(e,t){sprLib.rest({url:o+"?$select=Fields&$expand=Fields",metadata:!1}).then(function(t){var r=[];(t&&t[0]&&t[0].Fields&&t[0].Fields.results?t[0].Fields.results:[]).forEach(function(e,t){e.Hidden||"Edit"==e.InternalName||"DocIcon"==e.InternalName||0==e.InternalName.indexOf("_")||r.push({dispName:e.Title,dataName:e.InternalName,dataType:e.TypeAsString,isAppend:e.AppendOnly||!1,isNumPct:e.SchemaXml.toLowerCase().indexOf('percentage="true"')>-1,isReadOnly:e.ReadOnlyField,isRequired:e.Required,isUnique:e.EnforceUniqueValues,defaultValue:e.DefaultValue||null,maxLength:e.MaxLength||null})}),e(r)}).catch(function(e){t(e)})})},a.info=function(){return new Promise(function(e,t){sprLib.rest({url:o+"?$select=Id,AllowContentTypes,BaseTemplate,BaseType,Created,Description,DraftVersionVisibility,EnableAttachments,EnableFolderCreation,EnableVersioning,ForceCheckout,HasUniqueRoleAssignments,Hidden,ItemCount,LastItemDeletedDate,LastItemModifiedDate,LastItemUserModifiedDate,ListItemEntityTypeFullName,Title",metadata:!1}).then(function(t){e(t&&t.length>0?t[0]:[])}).catch(function(e){t(e)})})},a.perms=function(e){return new Promise(function(e,t){sprLib.rest({url:o+"/RoleAssignments?$select=",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(t){t.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=i[e.Member.PrincipalType]||e.Member.PrincipalType}),e(t||[])}).catch(function(e){t(e)})})},a.items=function(e){var t="";return new Promise(function(a,i){if(""!=(e=e||{})&&e!=[]||(e={}),e.queryFilter&&(e.queryFilter=e.queryFilter.replace(/\"/gi,"'")),"string"==typeof e||"number"==typeof e){var s={};s[e.toString()]={dataName:e.toString()},e={listCols:s}}else if(Array.isArray(e)){u={};e.forEach(function(e,t){var r=e.indexOf("/")>-1?e.substring(0,e.indexOf("/")):e;e&&(u[r]=u[r]?{dataName:u[r].dataName+","+e}:{dataName:e})}),e={listCols:u}}else if("string"==typeof e.listCols){d={};Object.keys(e).forEach(function(t,r){d[t]=e[t]}),e.listCols=[e.listCols];u={};e.listCols.forEach(function(e,t){var r=e.indexOf("/")>-1?e.substring(0,e.indexOf("/")):e;e&&(u[r]=u[r]?{dataName:u[r].dataName+","+e}:{dataName:e})}),d.listCols=u,e=d}else if(Array.isArray(e.listCols)){var d={};Object.keys(e).forEach(function(t,r){d[t]=e[t]});var u={};e.listCols.filter(function(e,t,r){return r.indexOf(e)===t}).forEach(function(e,t){var r=e.indexOf("/")>-1?e.substring(0,e.indexOf("/")):e;e&&(u[r]=u[r]?{dataName:u[r].dataName+","+e}:{dataName:e})}),d.listCols=u,e=d}else e.listCols||(e.listCols={});e.spArrData=[],e.spObjData={},"object"==typeof e.listCols&&Object.keys(e.listCols).length>0&&Object.keys(e.listCols).forEach(function(t){e.listCols[t].getVersions&&(e.metadata=!0)}),Promise.resolve().then(function(){return new Promise(function(a,i){var s={url:o+"/items",type:"GET",cache:e.cache||n.cache,metadata:e.metadata||n.metadata,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":l}},d=[],u="";e.queryNext&&("object"==typeof e.queryNext&&e.queryNext.prevId&&e.queryNext.maxItems||(e.queryNext=null,console.log('ERROR: queryNext should be an object with `prevId` and `maxItems`. EX: `{"prevId":200,"maxItems":100}`'))),e.queryNext&&e.listCols&&Object.keys(e.listCols).length>0?s.url+="?%24skiptoken=Paged%3dTRUE%26p_ID%3d"+e.queryNext.prevId+"&%24select=":e.listCols&&Object.keys(e.listCols).length>0&&(s.url+="?$select="),Object.keys(e.listCols).forEach(function(t){var r=e.listCols[t];if(r.dataName&&("="==s.url.substring(s.url.length-1)?s.url+=r.dataName:s.url+=s.url.lastIndexOf(",")==s.url.length-1?r.dataName:","+r.dataName,r.dataName.indexOf("/")>-1)){var a=r.dataName.substring(0,r.dataName.indexOf("/"));-1==d.indexOf(a)&&(d.push(a),u+=(""==u?"":",")+a)}}),u&&(s.url+=(s.url.indexOf("?")>-1?"&":"?")+"$expand="+u),e.queryFilter&&(s.url+=(s.url.indexOf("?")>-1?"&":"?")+"$filter="+(-1==e.queryFilter.indexOf("%")?encodeURI(e.queryFilter):e.queryFilter)),e.queryOrderby&&(s.url+=(s.url.indexOf("?")>-1?"&":"?")+"$orderby="+e.queryOrderby),e.queryNext?s.url+="&p_ID="+e.queryNext.prevId+"&$top="+e.queryNext.maxItems:s.url+=(s.url.indexOf("?$")>-1?"&":"?")+"$top="+(e.queryLimit?e.queryLimit:n.maxRows),sprLib.rest(s).then(function(i){if((!e.listCols||0==Object.keys(e.listCols).length)&&i.length>0){var s={};Object.keys(i[0]).forEach(function(e,t){i[0][e]&&"object"==typeof i[0][e]&&i[0][e].__deferred?r&&console.log('FYI: Skipping "select all" column: '+e):s[e]={dataName:e}}),e.listCols=s}i.forEach(function(r,a){var i={},s=0;r.__metadata&&(i.__metadata=r.__metadata,r.__metadata.uri&&(r.__metadata.uri.indexOf("/Items(")>-1&&(s=Number(r.__metadata.uri.split("/Items(").pop().replace(")",""))),!t&&r.__metadata.uri.indexOf("guid'")>-1&&(t=r.__metadata.uri.split("guid'").pop().split("')/")[0]))),r.__next&&(i.__next=r.__next),Object.keys(e.listCols).forEach(function(t){var a=e.listCols[t],s=[],o="";if(a.dataName&&a.dataName.indexOf("/")>-1&&r[a.dataName.split("/")[0]].results){if(i[t])return;o=[],r[a.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,o.push(e)})}else a.dataName&&a.dataName.indexOf("/")>-1?(s=a.dataName.split("/"),r[s[0]].__metadata&&delete r[s[0]].__metadata,r[s[0]].__deferred&&delete r[s[0]].__deferred,(o=t!=s[0]&&t!=a.dataName?r[s[0]][s[1]]:r[s[0]])&&"object"==typeof o&&!Array.isArray(o)&&0==Object.keys(o).length&&(o=null)):a.dataName?o=r[a.dataName]:a.dataFunc&&(o=a.dataFunc(r));"DateTime"==a.dataType?i[t]=new Date(o):i[t]=n.cleanColHtml&&"string"==a.listDataType?o.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):o,a.getVersions&&(i[t]=[])}),e.spArrData.push(i),s&&(e.spObjData[s]=i)}),a()}).catch(function(e){i(e)})})}).then(function(){var r=[],n=[];Object.keys(e.listCols).forEach(function(t){var a=e.listCols[t];a.getVersions&&(a.keyName=t,r.push(a),n.push(a.dataName))}),t&&r.length?sprLib.rest({url:"_vti_bin/owssvr.dll?Cmd=Display&List=%7B"+t+"%7D&XMLDATA=TRUE&IncludeVersions=TRUE&Query=ID%20"+n.toString().replace(/\,/g,"%20")+"%20Modified%20Editor%20&SortField=Modified&SortDir=ASC"}).then(function(t){t&&t[0]&&t[0].documentElement&&t[0].documentElement.querySelectorAll("row").forEach(function(t){r.forEach(function(r,a){var i=t.getAttribute("ows_ID"),n="";if(e.spObjData[i]&&t.getAttribute("ows_"+r.dataName)){var s=t.getAttribute("ows_"+r.dataName)||"";s&&(s!=n?(e.spObjData[i][r.keyName].push({verDate:new Date(t.getAttribute("ows_Modified").replace(" ","T")).toISOString(),verName:t.getAttribute("ows_Editor").substring(t.getAttribute("ows_Editor").indexOf("#")+1),verText:s}),n=s):(e.spObjData[i][r.keyName].pop(),e.spObjData[i][r.keyName].push({verDate:new Date(t.getAttribute("ows_Modified").replace(" ","T")).toISOString(),verName:t.getAttribute("ows_Editor").substring(t.getAttribute("ows_Editor").indexOf("#")+1),verText:s})))}})}),a(e.spArrData)}).catch(function(e){i(e)}):a(e.spArrData)}).catch(function(e){i(e)})})},a.getItems=a.items,a.create=function(e){return new Promise(function(r,a){e&&!Array.isArray(e)&&"object"==typeof e&&0!=Object.keys(e).length||a("Object type expected! Ex: `{Title:'New Emp'}`");try{JSON.stringify(e)}catch(e){a("`JSON.stringify(jsonData)` failed! Send valid JSON Please. Ex: `{'Name':'Brent'}`")}e.__metadata=e.__metadata||{},delete e.__metadata.etag,delete e.__next,Promise.resolve().then(function(){return e.__metadata.type?null:t()}).then(function(t){t&&t.type&&(e.__metadata=t),sprLib.rest({type:"POST",url:o+"/items",data:JSON.stringify(e),metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":l}}).then(function(t){t&&t[0]?(e.Id=t[0].Id,e.ID=t[0].ID,e.__metadata=e.__metadata||t[0].__metadata||{},e.__metadata.etag=e.__metadata.etag||(t[0].__metadata?t[0].__metadata.etag:null)):e=null,r(e)}).catch(function(e){a(e)})}).catch(function(e){a(e)})})},a.update=function(e){return new Promise(function(r,a){e&&!Array.isArray(e)&&"object"==typeof e&&0!=Object.keys(e).length||a("Object type expected! Ex: `{Title:'Brent'}`"),e.ID||e.Id||e.iD||e.id||a("Object must have an `Id` property! Ex: `{Id:99}`");try{JSON.stringify(e)}catch(e){a("`JSON.stringify(jsonData)` failed! Send valid object. Ex: `{'Title':'Brent'}`")}var i=e.ID||e.Id||e.iD||e.id;delete e.ID,delete e.Id,delete e.iD,delete e.id,e.__metadata=e.__metadata||{},""!=e.__metadata.etag&&null!=e.__metadata.etag||delete e.__metadata.etag,delete e.__next,Promise.resolve().then(function(){return e.__metadata.type?null:t()}).then(function(t){t&&t.type&&(e.__metadata.type=t.type),sprLib.rest({type:"POST",url:o+"/items("+i+")",data:JSON.stringify(e),metadata:!0,headers:{"X-HTTP-Method":"MERGE",Accept:"application/json;odata=verbose","X-RequestDigest":l,"IF-MATCH":e.__metadata.etag?e.__metadata.etag:"*"}}).then(function(t){e.Id=i,e.ID=i,e.__metadata.etag&&(e.__metadata.etag='"'+(Number(e.__metadata.etag.replace(/[\'\"]+/gi,""))+1)+'"'),r(e)}).catch(function(e){a(e)})})})},a.delete=function(e){return new Promise(function(r,a){e&&!Array.isArray(e)&&"object"==typeof e&&0!=Object.keys(e).length||a("Object type expected! Ex: `{'ID':123}`"),e.ID||e.Id||e.iD||e.id||a("Object data must have an `Id` property! Ex: `{'ID':123}`");try{JSON.stringify(e)}catch(e){a("`JSON.stringify(jsonData)` failed! Please pass a valid object. Ex: `{'ID':123}`")}var i=e.ID||e.Id||e.iD||e.id;delete e.ID,delete e.Id,delete e.iD,delete e.id,e.__metadata=e.__metadata||{},""!=e.__metadata.etag&&null!=e.__metadata.etag||delete e.__metadata.etag,delete e.__next,Promise.resolve().then(function(){return e.__metadata.type?null:t()}).then(function(t){t&&t.type&&(e.__metadata.type=t.type),sprLib.rest({type:"DELETE",url:o+"/items("+i+")",metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":l,"X-HTTP-Method":"MERGE","IF-MATCH":e.__metadata.etag?e.__metadata.etag:"*"}}).then(function(){r(i)}).catch(function(e){a(e)})})})},a.recycle=function(e){return new Promise(function(t,r){e&&!Array.isArray(e)&&"object"==typeof e&&0!=Object.keys(e).length||r("Object type expected! Ex: `{'ID':123}`"),e.ID||e.Id||e.iD||e.id||r("Object data must have an `Id` property! Ex: `{'ID':123}`");try{JSON.stringify(e)}catch(e){r("`JSON.stringify(jsonData)` failed! Please pass a valid object. Ex: `{'ID':123}`")}var a=e.ID||e.Id||e.iD||e.id;delete e.ID,delete e.Id,delete e.iD,delete e.id,e.__metadata=e.__metadata||{},""!=e.__metadata.etag&&null!=e.__metadata.etag||delete e.__metadata.etag,delete e.__next,sprLib.rest({type:"POST",url:o+"/items("+a+")/recycle()",metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":l}}).then(function(){t(Number(a))}).catch(function(e){r(e)})})},a},sprLib.rest=function(t){return new Promise(function(a,i){(t=t||{}).spArrData=[],t.cache=t.cache||n.cache,t.digest=t.requestDigest||("undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null),t.metadata=void 0!==t.metadata&&null!=t.metadata?t.metadata:n.metadata,t.type=t.restType||t.type||"GET",t.url=(t.restUrl||t.url||n.baseUrl).replace(/\"/g,"'");var s=[],l="",d={url:t.url,type:t.type,cache:t.cache,headers:t.headers||{Accept:"application/json;odata=verbose","X-RequestDigest":t.digest}};if(t.data&&(d.data=t.data),"POST"!=d.type||d.headers.contentType||(d.headers["content-type"]="application/json;odata=verbose"),d.url=0==t.url.toLowerCase().indexOf("http")||0==t.url.indexOf("/")?"":n.baseUrl,d.url+=(0!=t.url.toLowerCase().indexOf("http")&&0!=t.url.indexOf("/")?"/":"")+t.url,t.queryCols){if(-1==d.url.toLowerCase().indexOf("$select")&&(d.url+="?$select="),"string"==typeof t.queryCols&&(t.queryCols=[t.queryCols]),Array.isArray(t.queryCols)){var u={};t.queryCols.forEach(function(e,t){var r=e.indexOf("/")>-1?e.substring(0,e.indexOf("/")):e;u[r]=u[r]?{dataName:u[r].dataName+","+e}:{dataName:e}}),t.queryCols=u}"object"==typeof t.queryCols&&Object.keys(t.queryCols).forEach(function(e){var r=t.queryCols[e];if(r.dataName&&("="==d.url.substring(d.url.length-1)?d.url+=r.dataName:d.url+=d.url.lastIndexOf(",")==d.url.length-1?r.dataName:","+r.dataName,r.dataName.indexOf("/")>-1)){r.dataName.substring(0,r.dataName.indexOf("/"));var a=r.dataName.substring(0,r.dataName.lastIndexOf("/"));-1==s.indexOf(a)&&(s.push(a),l+=(""==l?"":",")+a)}})}(t.queryFilter||d.url.toLowerCase().indexOf("$select")>-1)&&-1==t.url.toLowerCase().indexOf("$top")&&"GET"==t.type&&(d.url+=(d.url.indexOf("?")>0?"&":"?")+"$top="+(t.queryLimit?t.queryLimit:n.maxRows)),-1==t.url.toLowerCase().indexOf("$filter")&&t.queryFilter&&(d.url+=(d.url.indexOf("?")>0?"&":"?")+"$filter="+(-1==t.queryFilter.indexOf("%")?encodeURI(t.queryFilter):t.queryFilter)),-1==t.url.toLowerCase().indexOf("$orderby")&&t.queryOrderby&&(d.url+=(d.url.indexOf("?")>0?"&":"?")+"$orderby="+t.queryOrderby),-1==t.url.toLowerCase().indexOf("$expand")&&l&&(d.url+=(d.url.indexOf("?")>0?"&":"?")+"$expand="+l),Promise.resolve().then(function(){return new Promise(function(t,r){if(NODEJS&&n.nodeEnabled){d.headers.Cookie=n.nodeCookie;var a={hostname:n.nodeServer,path:d.url,method:d.type,headers:d.headers},i=https.request(a,function(e){var a="";e.setEncoding("utf8"),e.on("data",function(e){a+=e}),e.on("end",function(){a.indexOf("HTTP Error")>-1?r():a.indexOf('{"error"')>-1&&a.indexOf('{"code"')>-1?r(JSON.parse(a).error.message.value+"\n\nURL used: "+d.url):t(a)}),e.on("error",function(e){r(JSON.parse(a).error.message.value+"\n\nURL used: "+d.url)})});d.data&&i.write(d.data),i.end()}else(i=new XMLHttpRequest).open(d.type,d.url,!0),Object.keys(d.headers||{}).forEach(function(e){i.setRequestHeader(e,d.headers[e])}),i.onload=function(){i.status>=200&&i.status<400?t(i.responseXML||i.responseText):r(e(i)+"\n\nURL used: "+d.url)},i.onerror=function(){r(e(i)+"\n\nURL used: "+d.url)},i.send(d.data?d.data:null)})}).then(function(e){var r=(e="string"==typeof e&&0==e.indexOf("{")?JSON.parse(e):e)&&e.d&&!e.d.results&&"object"==typeof e.d&&Object.keys(e.d).length>0?[e.d]:[];if(d.url.toLowerCase().indexOf("owssvr.dll")>-1&&d.url.toLowerCase().indexOf("includeversions=true")>-1)t.spArrData.push(e);else if(r.length>0||e&&e.d&&e.d.results&&"object"==typeof e.d.results)(r.length>0?r:e.d.results).forEach(function(r){var a={};if(t.queryCols?Array.isArray(t.queryCols)?t.queryCols.forEach(function(e){a[e]=n.cleanColHtml&&"string"==col.listDataType?colVal.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):colVal}):Object.keys(t.queryCols).forEach(function(e){var i=t.queryCols[e],s=[],o="";if(i.dataName&&i.dataName.indexOf("/")>-1&&r[i.dataName.split("/")[0]]&&r[i.dataName.split("/")[0]].results){if(a[e])return;o=[],r[i.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,o.push(e)})}else i.dataName&&i.dataName.indexOf("/")>-1?(i.dataName.split(",").forEach(function(t,a){var n=t.split("/");r[n[0]]&&r[n[0]].__metadata&&delete r[n[0]].__metadata,r[n[0]]&&r[n[0]].__deferred&&delete r[n[0]].__deferred;var s=null;2==n.length?((s=r[n[0]])&&"object"==typeof s&&"results"==Object.keys(s)[0]&&(r[n[0]]=s.results),o=e!=n[0]&&e!=i.dataName?r[n[0]][n[1]]:r[n[0]]):3==n.length?((s=r[n[0]][n[1]])&&"object"==typeof s&&"results"==Object.keys(s)[0]&&(r[n[0]][n[1]]=s.results),o=e!=n[0]&&e!=i.dataName?r[n[0]][n[1]][n[2]]:r[n[0]]):4==n.length?((s=r[n[0]][n[1]][n[2]])&&"object"==typeof s&&"results"==Object.keys(s)[0]&&(r[n[0]][n[1]][n[2]]=s.results),o=e!=n[0]&&e!=i.dataName?r[n[0]][n[1]][n[2]][n[3]]:r[n[0]]):n.length>4&&console.log("This is madness!!")}),"object"!=typeof o||Array.isArray(o)||0!=Object.keys(o).length||(o=[])):i.dataName&&(s=i.dataName.split("/"),o=s.length>1?r[s[0]][s[1]]:r[s[0]]);"DateTime"==i.dataType?a[e]=new Date(o):a[e]=n.cleanColHtml&&"string"==i.listDataType?o.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):o}):Object.keys(r).forEach(function(e){var t=r[e];a[e]=t}),a.__metadata&&!t.metadata&&delete a.__metadata,e.d.__next){var i={prevId:"",maxItems:""};e.d.__next.split("&").forEach(function(e,t){e.indexOf("p_ID%3d")>-1?i.prevId=e.split("&")[0].split("%3d")[2]:e.indexOf("%24top=")>-1&&(i.maxItems=e.substring(e.lastIndexOf("=")+1))}),i.prevId&&i.maxItems&&(a.__next=i)}t.spArrData.push(a)});else if((e&&e.d?e.d:e||!1)&&"object"==typeof(e.d||e)&&Object.keys(e.d||e).length>0){var i={},s=e.d||e;Object.keys(s).forEach(function(e){var t=s[e];i[e]=t}),i.__metadata&&!t.metadata&&delete i.__metadata,t.spArrData.push(i)}a(t.spArrData)}).catch(function(e){(!NODEJS||n.nodeEnabled)&&"string"==typeof e&&e.indexOf("(403)")>-1&&o<=n.maxRetries?Promise.resolve().then(function(){return sprLib.renewSecurityToken()}).then(function(){var e=document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null;r&&console.log("err-403: token renewed"),t.headers&&t.headers["X-RequestDigest"]&&(t.headers["X-RequestDigest"]=e),o++,sprLib.rest(t)}):(o=0,i(e))})})},sprLib.site=function(e){var t={},r=e?(e+"/").replace(/\/+$/g,"/"):"";return t.info=function(){return new Promise(function(e,t){Promise.all([sprLib.rest({url:r+"_api/web",queryCols:["Id","Title","Description","Language","Created","LastItemModifiedDate","LastItemUserModifiedDate","RequestAccessEmail","SiteLogoUrl","Url","WebTemplate","AssociatedOwnerGroup/Id","AssociatedMemberGroup/Id","AssociatedVisitorGroup/Id","AssociatedOwnerGroup/OwnerTitle","AssociatedMemberGroup/OwnerTitle","AssociatedVisitorGroup/OwnerTitle","AssociatedOwnerGroup/Title","AssociatedMemberGroup/Title","AssociatedVisitorGroup/Title"],cache:!1}),sprLib.rest({url:r+"_api/site",queryCols:["Owner/Email","Owner/LoginName","Owner/Title","Owner/IsSiteAdmin"],cache:!1})]).then(function(t){var r=t[0][0];r.Owner=t[1][0].Owner,delete r.Owner.__metadata,delete r.AssociatedMemberGroup.__metadata,delete r.AssociatedOwnerGroup.__metadata,delete r.AssociatedVisitorGroup.__metadata,r.hasOwnProperty("LastItemUserModifiedDate")&&!r.LastItemUserModifiedDate&&delete r.LastItemUserModifiedDate,e(r)}).catch(function(e){t(e)})})},t.lists=function(){return new Promise(function(e,t){sprLib.rest({url:r+"_api/web/lists",queryCols:["Id","Title","Description","ItemCount","BaseType","BaseTemplate","Hidden","ImageUrl","ParentWebUrl","RootFolder/ServerRelativeUrl"]}).then(function(t){t.forEach(function(e,t){e.ServerRelativeUrl=e.RootFolder&&e.RootFolder.ServerRelativeUrl?e.RootFolder.ServerRelativeUrl:null,e.RootFolder&&delete e.RootFolder,e.BaseType=a[e.BaseType]||e.BaseType}),e(t||[])}).catch(function(e){t(e)})})},t.subsites=function(){return new Promise(function(e,t){sprLib.rest({url:r+"_api/web/webs",queryCols:{Id:{dataName:"Id",dispName:"Id"},Name:{dataName:"Title",dispName:"Subsite Name"},UrlAbs:{dataName:"Url",dispName:"Absolute URL"},UrlRel:{dataName:"ServerRelativeUrl",dispNAme:"Relative URL"},Created:{dataName:"Created",dispName:"Date Created"},Modified:{dataName:"LastItemModifiedDate",dispName:"Date Last Modified"},Language:{dataName:"Language",dispName:"Language"},SiteLogoUrl:{dataName:"SiteLogoUrl",dispName:"Site Logo URL"}}}).then(function(t){e(t||[])}).catch(function(e){t(e)})})},t.perms=function(){return new Promise(function(e,t){sprLib.rest({url:r+"_api/web/roleAssignments",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(t){t.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=i[e.Member.PrincipalType]||e.Member.PrincipalType}),e(t||[])}).catch(function(e){t(e)})})},t.roles=function(){return new Promise(function(e,t){sprLib.rest({url:r+"_api/web/roleDefinitions",queryCols:["Id","Name","Description","RoleTypeKind","Hidden"]}).then(function(t){e(t||[])}).catch(function(e){t(e)})})},t.groups=function(t){return new Promise(function(a,n){var s=[];if(e){var o=[],l="Member/PrincipalType eq 8";t&&t.id?l="Member/Id eq "+t.id:t&&t.title&&(l="Member/Title eq '"+t.title+"'"),sprLib.rest({url:r+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Description","Member/OwnerTitle","Member/PrincipalType","Member/AllowMembersEditMembership"],queryFilter:l,queryLimit:5e3}).then(function(e){e.forEach(function(e,t){s.push({Id:e.Member.Id,Title:e.Member.Title,Description:e.Member.Description,OwnerTitle:e.Member.OwnerTitle,PrincipalType:i[e.Member.PrincipalType]||e.Member.PrincipalType,AllowMembersEditMembership:e.Member.AllowMembersEditMembership,Users:[]}),o.push(sprLib.rest({url:r+"_api/web/SiteGroups/GetById("+e.Member.Id+")/Users",queryCols:["Id","LoginName","Title"],queryLimit:5e3}))}),Promise.all(o).then(function(e,t){e.forEach(function(e,t){e.forEach(function(e,r){s[t].Users.push({Id:e.Id,LoginName:e.LoginName,Title:e.Title})})}),a(s||[])})}).catch(function(e){n(e)})}else{l="";t&&t.id?l="Id eq "+t.id:t&&t.title&&(l="Title eq '"+t.title+"'"),sprLib.rest({url:r+"_api/web/SiteGroups",queryCols:["Id","Title","PrincipalType","Description","OwnerTitle","AllowMembersEditMembership","Users/Id","Users/Title","Users/LoginName"],queryFilter:l,queryLimit:5e3}).then(function(e){e&&Array.isArray(e)&&(e=e.filter(function(e){return-1==e.Title.indexOf("SharingLinks")})),e.forEach(function(e,t){e.PrincipalType=i[e.PrincipalType]||e.PrincipalType}),a(e||[])}).catch(function(e){n(e)})}})},t.users=function(){return new Promise(function(t,a){e?Promise.all([sprLib.rest({url:r+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Email","Member/LoginName","Member/Title","Member/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 1",queryLimit:5e3}),sprLib.rest({url:r+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Users/Id","Member/Users/Email","Member/Users/LoginName","Member/Users/Title","Member/Users/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 8",queryLimit:5e3})]).then(function(e){var r=[],a={};e[0].forEach(function(e,t){e.Member.Groups=[],r.push(e.Member),a[e.Member.Id]=e.Member}),e[1].forEach(function(e,t){e.Member.Users&&e.Member.Users.length>0&&e.Member.Users.forEach(function(t,i){t.__metadata&&delete t.__metadata,t.Groups||(t.Groups=[]),t.Groups.push({Id:e.Member.Id,Title:e.Member.Title}),a[t.Id]?(a[t.Id].Groups||(a[t.Id].Groups=[]),a[t.Id].Groups.push({Id:e.Member.Id,Title:e.Member.Title})):(r.push(t),a[t.Id]=e.Member)})}),t(r||[])}).catch(function(e){a(e)}):sprLib.rest({url:r+"_api/web/SiteUsers",queryCols:["Id","Email","LoginName","Title","IsSiteAdmin","Groups/Id","Groups/Title"],queryFilter:"PrincipalType eq 1",queryLimit:5e3}).then(function(e){e&&Array.isArray(e)&&(e=e.filter(function(e){return-1==e.Title.indexOf("spocrwl")&&e.Id<1e9})),t(e||[])}).catch(function(e){a(e)})})},t},sprLib.user=function(e){var t={},a="_api/Web",i="/CurrentUser?";return e&&"object"==typeof e&&Object.keys(e).length>0&&e.baseUrl&&(a=e.baseUrl.toString().replace(/\/+$/,"")+"/_api/Web"),e&&e.id?i="/siteusers?$filter=Id%20eq%20"+e.id+"&":e&&e.email?i="/siteusers?$filter=Email%20eq%20%27"+e.email+"%27&":e&&e.login?i="/siteusers?$filter=LoginName%20eq%20%27"+e.login.replace(/#/g,"%23")+"%27&":e&&e.title&&(i="/siteusers?$filter=Title%20eq%20%27"+e.title+"%27&"),i=a+i,t.info=function(){return new Promise(function(e,t){sprLib.rest({url:i+"$select=Id,Title,Email,LoginName,IsSiteAdmin,PrincipalType",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(t){var r={};(t&&Array.isArray(t)&&t[0]&&Object.keys(t[0]).length>0?Object.keys(t[0]):[]).forEach(function(e,a){r[e]=t[0][e]}),e(r)}).catch(function(e){t(e)})})},t.groups=function(){return new Promise(function(e,t){sprLib.rest({url:i+"$select=Groups/Id,Groups/Title,Groups/Description,Groups/LoginName,Groups/OwnerTitle&$expand=Groups",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(t){var r=[];(t&&t[0]&&t[0].Groups&&t[0].Groups.results?t[0].Groups.results:[]).forEach(function(e,t){r.push({Id:e.Id,Title:e.Title,Description:e.Description,OwnerTitle:e.OwnerTitle,LoginName:e.LoginName})}),e(r)}).catch(function(e){t(e)})})},t.profile=function(t){return new Promise(function(a,i){var n=Array.isArray(t)?t:"string"==typeof t?[t]:null,s=e&&e.login?encodeURIComponent(e.login):null;Promise.resolve().then(function(){if(e&&!e.login)return sprLib.user(e).info()}).then(function(e){return e&&(s=encodeURIComponent(e.LoginName)),s?sprLib.rest({url:"_api/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v='"+s+"'",type:"POST",metadata:!1}):sprLib.rest({url:"_api/SP.UserProfiles.PeopleManager/GetMyProperties",metadata:!1})}).then(function(e){var t={};if(e&&e[0]&&e[0].hasOwnProperty("GetPropertiesFor")&&a({}),e[0]&&Array.isArray(n)&&n.length>0?n.forEach(function(r){t[r]=e[0][r]||"ERROR: No such property exists in SP.UserProfiles.PeopleManager"}):e[0]?t=e[0]:r&&console.log("??? `arrProfileProps[0]` does not exist!"),Object.keys(t).forEach(function(e){t[e]&&t[e].__metadata&&delete t[e].__metadata,t[e]&&t[e].ValueType&&delete t[e].ValueType,"UserProfileProperties"==e&&(t[e]=t[e].results),t[e]&&t[e].results&&(t[e]=t[e].results)}),t.UserProfileProperties){var i={};t.UserProfileProperties.forEach(function(e){i[e.Key]=e.Value}),t.UserProfileProperties=i}a(0==Object.keys(t).length?{}:t)}).catch(function(e){i(e)})})},t},sprLib.renewSecurityToken=function(){return t()},sprLib.nodeConfig=function(e){e=e&&"object"==typeof e?e:{},n.nodeCookie=e.cookie||"",n.nodeEnabled=void 0===e.nodeEnabled||e.nodeEnabled,n.nodeServer=e.server||""}}(),NODEJS){var https=require("https"),isElectron=require("is-electron");module.exports=sprLib}