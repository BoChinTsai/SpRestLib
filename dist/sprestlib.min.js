/* SpRestLib 1.7.0-beta-20180416 */
var NODEJS="undefined"!=typeof module&&module.exports&&"function"==typeof require&&require("https");if(function(){var u=!1,a={0:"List",1:"Library",3:"Discussion Board",4:"Survey",5:"Issue"},c={0:"None",1:"User",2:"Distribution List",4:"Security Group",8:"SharePoint Group",15:"All"},p={baseUrl:"..",busySpinnerHtml:'<div class="sprlib-spinner"><div class="sprlib-bounce1"></div><div class="sprlib-bounce2"></div><div class="sprlib-bounce3"></div></div>',cache:!1,cleanColHtml:!0,currencyChar:"$",language:"en",maxRetries:2,maxRows:5e3,metadata:!1,nodeCookie:"",nodeEnabled:!0,nodeServer:"",retryAfter:1e3},i=/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/i,r=0;function d(t){var e="("+(t=t||{}).status+") "+t.responseText;try{JSON.parse(t.responseText).error.code.split(",")[0],e="("+t.status+") "+JSON.parse(t.responseText).error.message.value}catch(e){u&&console.warn("Unable to parse jqXHR response:\n"+t.responseText)}return e}this.sprLib={},sprLib.version="1.7.0-beta-20180416",sprLib.baseUrl=function(e){if("string"!=typeof e||""==e||!e)return p.baseUrl;p.baseUrl=e.replace(/\/+$/,""),u&&console.log("APP_OPTS.baseUrl = "+p.baseUrl)},sprLib.library=function(e){var t={},r="_api/lists";(e=e||{}).requestDigest||"undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")&&document.getElementById("__REQUESTDIGEST").value;if(e.guid&&(e.name=e.guid),e&&"string"==typeof e)r+=i.test(e)?"(guid'"+e+"')":"/getbytitle('"+e.replace(/\s/gi,"%20")+"')";else{if(!e||"object"!=typeof e||!e.hasOwnProperty("name"))return console.error("ERROR: A 'listName' or 'listGUID' is required! EX: `sprLib.library('Documents')` or `sprLib.library({ 'name':'Documents' })`"),console.error("ARGS:"),console.error(e),null;r=e.baseUrl?e.baseUrl.replace(/\/+$/,"")+"/_api/lists":r,r+=i.test(e.name)?"(guid'"+e.name+"')":"/getbytitle('"+e.name.replace(/\s/gi,"%20")+"')"}return t.cols=function(){return sprLib.list(e).cols()},t.info=function(){return sprLib.list(e).info()},t.perms=function(){return sprLib.list(e).perms()},t.upload=function(r){return new Promise(function(e,t){r=r&&"object"==typeof r&&0<Object.keys(r).length?r:{}})},t},sprLib.list=function(e){var t={},l="_api/lists",d=(e=e||{}).requestDigest||("undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null);if(e.guid&&(e.name=e.guid),e&&"string"==typeof e)l+=i.test(e)?"(guid'"+e+"')":"/getbytitle('"+e.replace(/\s/gi,"%20")+"')";else{if(!e||"object"!=typeof e||!e.hasOwnProperty("name"))return console.error("ERROR: A 'listName' or 'listGUID' is required! EX: `sprLib.list('Employees')` or `sprLib.list({ 'name':'Employees' })`"),console.error("ARGS:"),console.error(e),null;l=e.baseUrl?e.baseUrl.replace(/\/+$/,"")+"/_api/lists":l,l+=i.test(e.name)?"(guid'"+e.name+"')":"/getbytitle('"+e.name.replace(/\s/gi,"%20")+"')"}function n(){return new Promise(function(t,r){sprLib.rest({url:l+"?$select=ListItemEntityTypeFullName"}).then(function(e){e&&Array.isArray(e)&&1==e.length?t({type:e[0].ListItemEntityTypeFullName}):r("Invalid result!")}).catch(function(e){r(e)})})}return t.cols=function(){return new Promise(function(t,r){sprLib.rest({url:l+"?$select=Fields&$expand=Fields",metadata:!1}).then(function(e){var r=[];(e&&e[0]&&e[0].Fields&&e[0].Fields.results?e[0].Fields.results:[]).forEach(function(e,t){e.Hidden||"Edit"==e.InternalName||"DocIcon"==e.InternalName||0==e.InternalName.indexOf("_")||r.push({dispName:e.Title,dataName:e.InternalName,dataType:e.TypeAsString,isAppend:e.AppendOnly||!1,isNumPct:-1<e.SchemaXml.toLowerCase().indexOf('percentage="true"'),isReadOnly:e.ReadOnlyField,isRequired:e.Required,isUnique:e.EnforceUniqueValues,defaultValue:e.DefaultValue||null,maxLength:e.MaxLength||null})}),t(r)}).catch(function(e){r(e)})})},t.info=function(){return new Promise(function(t,r){sprLib.rest({url:l+"?$select=Id,AllowContentTypes,BaseTemplate,BaseType,Created,Description,DraftVersionVisibility,EnableAttachments,EnableFolderCreation,EnableVersioning,ForceCheckout,HasUniqueRoleAssignments,Hidden,ItemCount,LastItemDeletedDate,LastItemModifiedDate,LastItemUserModifiedDate,ListItemEntityTypeFullName,Title",metadata:!1}).then(function(e){t(e&&0<e.length?e[0]:[])}).catch(function(e){r(e)})})},t.perms=function(e){return new Promise(function(t,r){sprLib.rest({url:l+"/RoleAssignments?$select=",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(e){e.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=c[e.Member.PrincipalType]||e.Member.PrincipalType}),t(e||[])}).catch(function(e){r(e)})})},t.items=function(s){var o="";return new Promise(function(t,i){if(""!=(s=s||{})&&s!=[]||(s={}),s.queryFilter&&(s.queryFilter=s.queryFilter.replace(/\"/gi,"'")),"string"==typeof s||"number"==typeof s){var e={};e[s.toString()]={dataName:s.toString()},s={listCols:e}}else if(Array.isArray(s)){var a={};s.forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;e&&(a[r]=a[r]?{dataName:a[r].dataName+","+e}:{dataName:e})}),s={listCols:a}}else if("string"==typeof s.listCols){var r={};Object.keys(s).forEach(function(e,t){r[e]=s[e]}),s.listCols=[s.listCols];a={};s.listCols.forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;e&&(a[r]=a[r]?{dataName:a[r].dataName+","+e}:{dataName:e})}),r.listCols=a,s=r}else if(Array.isArray(s.listCols)){r={};Object.keys(s).forEach(function(e,t){r[e]=s[e]});a={};s.listCols.filter(function(e,t,r){return r.indexOf(e)===t}).forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;e&&(a[r]=a[r]?{dataName:a[r].dataName+","+e}:{dataName:e})}),r.listCols=a,s=r}else s.listCols||(s.listCols={});s.spArrData=[],s.spObjData={},"object"==typeof s.listCols&&0<Object.keys(s.listCols).length&&Object.keys(s.listCols).forEach(function(e){s.listCols[e].getVersions&&(s.metadata=!0)}),Promise.resolve().then(function(){return new Promise(function(e,t){var a={url:l+"/items",type:"GET",cache:s.cache||p.cache,metadata:s.metadata||p.metadata,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d}},i=[],n="";s.queryNext&&("object"==typeof s.queryNext&&s.queryNext.prevId&&s.queryNext.maxItems||(s.queryNext=null,console.log('ERROR: queryNext should be an object with `prevId` and `maxItems`. EX: `{"prevId":200,"maxItems":100}`'))),s.queryNext&&s.listCols&&0<Object.keys(s.listCols).length?a.url+="?%24skiptoken=Paged%3dTRUE%26p_ID%3d"+s.queryNext.prevId+"&%24select=":s.listCols&&0<Object.keys(s.listCols).length&&(a.url+="?$select="),Object.keys(s.listCols).forEach(function(e){var t=s.listCols[e];if(t.dataName&&("="==a.url.substring(a.url.length-1)?a.url+=t.dataName:a.url+=a.url.lastIndexOf(",")==a.url.length-1?t.dataName:","+t.dataName,-1<t.dataName.indexOf("/"))){var r=t.dataName.substring(0,t.dataName.indexOf("/"));-1==i.indexOf(r)&&(i.push(r),n+=(""==n?"":",")+r)}}),n&&(a.url+=(-1<a.url.indexOf("?")?"&":"?")+"$expand="+n),s.queryFilter&&(a.url+=(-1<a.url.indexOf("?")?"&":"?")+"$filter="+(-1==s.queryFilter.indexOf("%")?encodeURI(s.queryFilter):s.queryFilter)),s.queryOrderby&&(a.url+=(-1<a.url.indexOf("?")?"&":"?")+"$orderby="+s.queryOrderby),s.queryNext?a.url+="&p_ID="+s.queryNext.prevId+"&$top="+s.queryNext.maxItems:s.queryLimit&&(a.url+=(-1<a.url.indexOf("?$")?"&":"?")+"$top="+s.queryLimit),sprLib.rest(a).then(function(r){if((!s.listCols||0==Object.keys(s.listCols).length)&&0<r.length){var a={};Object.keys(r[0]).forEach(function(e,t){r[0][e]&&"object"==typeof r[0][e]&&r[0][e].__deferred?u&&console.log('FYI: Skipping "select all" column: '+e):a[e]={dataName:e}}),s.listCols=a}r.forEach(function(i,e){var n={},t=0;i.__metadata&&(n.__metadata=i.__metadata,i.__metadata.uri&&(-1<i.__metadata.uri.indexOf("/Items(")&&(t=Number(i.__metadata.uri.split("/Items(").pop().replace(")",""))),!o&&-1<i.__metadata.uri.indexOf("guid'")&&(o=i.__metadata.uri.split("guid'").pop().split("')/")[0]))),i.__next&&(n.__next=i.__next),Object.keys(s.listCols).forEach(function(e){var t=s.listCols[e],r=[],a="";if(t.dataName&&-1<t.dataName.indexOf("/")&&i[t.dataName.split("/")[0]].results){if(n[e])return;a=[],i[t.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,a.push(e)})}else t.dataName&&-1<t.dataName.indexOf("/")?(r=t.dataName.split("/"),i[r[0]].__metadata&&delete i[r[0]].__metadata,i[r[0]].__deferred&&delete i[r[0]].__deferred,(a=e!=r[0]&&e!=t.dataName?i[r[0]][r[1]]:i[r[0]])&&"object"==typeof a&&!Array.isArray(a)&&0==Object.keys(a).length&&(a=null)):t.dataName?a=i[t.dataName]:t.dataFunc&&(a=t.dataFunc(i));"DateTime"==t.dataType?n[e]=new Date(a):n[e]=p.cleanColHtml&&"string"==t.listDataType?a.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):a,t.getVersions&&(n[e]=[])}),s.spArrData.push(n),t&&(s.spObjData[t]=n)}),e()}).catch(function(e){t(e)})})}).then(function(){var r=[],a=[];Object.keys(s.listCols).forEach(function(e){var t=s.listCols[e];t.getVersions&&(t.keyName=e,r.push(t),a.push(t.dataName))}),o&&r.length?sprLib.rest({url:"_vti_bin/owssvr.dll?Cmd=Display&List=%7B"+o+"%7D&XMLDATA=TRUE&IncludeVersions=TRUE&Query=ID%20"+a.toString().replace(/\,/g,"%20")+"%20Modified%20Editor%20&SortField=Modified&SortDir=ASC"}).then(function(e){e&&e[0]&&e[0].documentElement&&e[0].documentElement.querySelectorAll("row").forEach(function(n){r.forEach(function(e,t){var r=n.getAttribute("ows_ID"),a="";if(s.spObjData[r]&&n.getAttribute("ows_"+e.dataName)){var i=n.getAttribute("ows_"+e.dataName)||"";i&&(i!=a?(s.spObjData[r][e.keyName].push({verDate:new Date(n.getAttribute("ows_Modified").replace(" ","T")).toISOString(),verName:n.getAttribute("ows_Editor").substring(n.getAttribute("ows_Editor").indexOf("#")+1),verText:i}),a=i):(s.spObjData[r][e.keyName].pop(),s.spObjData[r][e.keyName].push({verDate:new Date(n.getAttribute("ows_Modified").replace(" ","T")).toISOString(),verName:n.getAttribute("ows_Editor").substring(n.getAttribute("ows_Editor").indexOf("#")+1),verText:i})))}})}),t(s.spArrData)}).catch(function(e){i(e)}):t(s.spArrData)}).catch(function(e){i(e)})})},t.getItems=t.items,t.create=function(a){return new Promise(function(t,r){a&&!Array.isArray(a)&&"object"==typeof a&&0!=Object.keys(a).length||r("Object type expected! Ex: `{Title:'New Emp'}`");try{JSON.stringify(a)}catch(e){r("`JSON.stringify(jsonData)` failed! Send valid JSON Please. Ex: `{'Name':'Brent'}`")}a.__metadata=a.__metadata||{},delete a.__metadata.etag,delete a.__next,Promise.resolve().then(function(){return a.__metadata.type?null:n()}).then(function(e){e&&e.type&&(a.__metadata=e),sprLib.rest({type:"POST",url:l+"/items",data:JSON.stringify(a),metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d}}).then(function(e){e&&e[0]?(a.Id=e[0].Id,a.ID=e[0].ID,a.__metadata=a.__metadata||e[0].__metadata||{},a.__metadata.etag=a.__metadata.etag||(e[0].__metadata?e[0].__metadata.etag:null)):a=null,t(a)}).catch(function(e){r(e)})}).catch(function(e){r(e)})})},t.update=function(i){return new Promise(function(t,r){i&&!Array.isArray(i)&&"object"==typeof i&&0!=Object.keys(i).length||r("Object type expected! Ex: `{Title:'Brent'}`"),i.ID||i.Id||i.iD||i.id||r("Object must have an `Id` property! Ex: `{Id:99}`");try{JSON.stringify(i)}catch(e){r("`JSON.stringify(jsonData)` failed! Send valid object. Ex: `{'Title':'Brent'}`")}var a=i.ID||i.Id||i.iD||i.id;delete i.ID,delete i.Id,delete i.iD,delete i.id,i.__metadata=i.__metadata||{},""!=i.__metadata.etag&&null!=i.__metadata.etag||delete i.__metadata.etag,delete i.__next,Promise.resolve().then(function(){return i.__metadata.type?null:n()}).then(function(e){e&&e.type&&(i.__metadata.type=e.type),sprLib.rest({type:"POST",url:l+"/items("+a+")",data:JSON.stringify(i),metadata:!0,headers:{"X-HTTP-Method":"MERGE",Accept:"application/json;odata=verbose","X-RequestDigest":d,"IF-MATCH":i.__metadata.etag?i.__metadata.etag:"*"}}).then(function(e){i.Id=a,i.ID=a,i.__metadata.etag&&(i.__metadata.etag='"'+(Number(i.__metadata.etag.replace(/[\'\"]+/gi,""))+1)+'"'),t(i)}).catch(function(e){r(e)})})})},t.delete=function(i){return new Promise(function(t,r){i&&!Array.isArray(i)&&"object"==typeof i&&0!=Object.keys(i).length||r("Object type expected! Ex: `{'ID':123}`"),i.ID||i.Id||i.iD||i.id||r("Object data must have an `Id` property! Ex: `{'ID':123}`");try{JSON.stringify(i)}catch(e){r("`JSON.stringify(jsonData)` failed! Please pass a valid object. Ex: `{'ID':123}`")}var a=i.ID||i.Id||i.iD||i.id;delete i.ID,delete i.Id,delete i.iD,delete i.id,i.__metadata=i.__metadata||{},""!=i.__metadata.etag&&null!=i.__metadata.etag||delete i.__metadata.etag,delete i.__next,Promise.resolve().then(function(){return i.__metadata.type?null:n()}).then(function(e){e&&e.type&&(i.__metadata.type=e.type),sprLib.rest({type:"DELETE",url:l+"/items("+a+")",metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d,"X-HTTP-Method":"MERGE","IF-MATCH":i.__metadata.etag?i.__metadata.etag:"*"}}).then(function(){t(a)}).catch(function(e){r(e)})})})},t.recycle=function(a){return new Promise(function(e,t){a&&!Array.isArray(a)&&"object"==typeof a&&0!=Object.keys(a).length||t("Object type expected! Ex: `{'ID':123}`"),a.ID||a.Id||a.iD||a.id||t("Object data must have an `Id` property! Ex: `{'ID':123}`");try{JSON.stringify(a)}catch(e){t("`JSON.stringify(jsonData)` failed! Please pass a valid object. Ex: `{'ID':123}`")}var r=a.ID||a.Id||a.iD||a.id;delete a.ID,delete a.Id,delete a.iD,delete a.id,a.__metadata=a.__metadata||{},""!=a.__metadata.etag&&null!=a.__metadata.etag||delete a.__metadata.etag,delete a.__next,sprLib.rest({type:"POST",url:l+"/items("+r+")/recycle()",metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":d}}).then(function(){e(Number(r))}).catch(function(e){t(e)})})},t},sprLib.rest=function(l){return new Promise(function(i,t){(l=l||{}).spArrData=[],l.cache=l.cache||p.cache,l.digest=l.requestDigest||("undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null),l.metadata=void 0!==l.metadata&&null!=l.metadata?l.metadata:p.metadata,l.type=l.restType||l.type||"GET",l.url=(l.restUrl||l.url||p.baseUrl).replace(/\"/g,"'");var a=[],n="",s={url:l.url,type:l.type,cache:l.cache,headers:l.headers||{Accept:"application/json;odata=verbose","X-RequestDigest":l.digest}};if(l.data&&(s.data=l.data),"POST"!=s.type||s.headers.contentType||(s.headers["content-type"]="application/json;odata=verbose"),s.url=0==l.url.toLowerCase().indexOf("http")||0==l.url.indexOf("/")?"":p.baseUrl,s.url+=(0!=l.url.toLowerCase().indexOf("http")&&0!=l.url.indexOf("/")?"/":"")+l.url,l.queryCols){if(-1==s.url.toLowerCase().indexOf("$select")&&(s.url+="?$select="),"string"==typeof l.queryCols&&(l.queryCols=[l.queryCols]),Array.isArray(l.queryCols)){var o={};l.queryCols.forEach(function(e,t){var r=-1<e.indexOf("/")?e.substring(0,e.indexOf("/")):e;o[r]=o[r]?{dataName:o[r].dataName+","+e}:{dataName:e}}),l.queryCols=o}"object"==typeof l.queryCols&&Object.keys(l.queryCols).forEach(function(e){var t=l.queryCols[e];if(t.dataName&&("="==s.url.substring(s.url.length-1)?s.url+=t.dataName:s.url+=s.url.lastIndexOf(",")==s.url.length-1?t.dataName:","+t.dataName,-1<t.dataName.indexOf("/"))){t.dataName.substring(0,t.dataName.indexOf("/"));var r=t.dataName.substring(0,t.dataName.lastIndexOf("/"));-1==a.indexOf(r)&&(a.push(r),n+=(""==n?"":",")+r)}})}(l.queryFilter||-1<s.url.toLowerCase().indexOf("$select"))&&"GET"==l.type&&-1==l.url.toLowerCase().indexOf("$top")&&l.queryLimit&&(s.url+=(0<s.url.indexOf("?")?"&":"?")+"$top="+l.queryLimit),-1==l.url.toLowerCase().indexOf("$filter")&&l.queryFilter&&(s.url+=(0<s.url.indexOf("?")?"&":"?")+"$filter="+(-1==l.queryFilter.indexOf("%")?encodeURI(l.queryFilter):l.queryFilter)),-1==l.url.toLowerCase().indexOf("$orderby")&&l.queryOrderby&&(s.url+=(0<s.url.indexOf("?")?"&":"?")+"$orderby="+l.queryOrderby),-1==l.url.toLowerCase().indexOf("$expand")&&n&&(s.url+=(0<s.url.indexOf("?")?"&":"?")+"$expand="+n),Promise.resolve().then(function(){return new Promise(function(r,a){if(NODEJS&&p.nodeEnabled){s.headers.Cookie=p.nodeCookie,s.data&&(s.headers["Content-Length"]=s.data.length);var e={hostname:p.nodeServer,path:s.url,method:s.type,headers:s.headers},t=https.request(e,function(e){var t="";e.setEncoding("utf8"),e.on("data",function(e){t+=e}),e.on("end",function(){-1<t.indexOf("HTTP Error")?a():-1<t.indexOf('{"error"')&&-1<t.indexOf('{"code"')?a(JSON.parse(t).error.message.value+"\n\nURL used: "+s.url):r(t)}),e.on("error",function(e){a(JSON.parse(t).error.message.value+"\n\nURL used: "+s.url)})});s.data&&t.write(s.data),t.end()}else{(t=new XMLHttpRequest).open(s.type,s.url,!0),Object.keys(s.headers||{}).forEach(function(e){t.setRequestHeader(e,s.headers[e])}),t.onload=function(){200<=t.status&&t.status<400?r(t.responseXML||t.responseText):a(d(t)+"\n\nURL used: "+s.url)},t.onerror=function(){a(d(t)+"\n\nURL used: "+s.url)},t.send(s.data?s.data:null)}}).catch(function(e){t(e)})}).then(function(e){var t=(e="string"==typeof e&&0==e.indexOf("{")?JSON.parse(e):e)&&e.d&&!e.d.results&&"object"==typeof e.d&&0<Object.keys(e.d).length?[e.d]:[];if(-1<s.url.toLowerCase().indexOf("owssvr.dll")&&-1<s.url.toLowerCase().indexOf("includeversions=true"))l.spArrData.push(e);else if(0<t.length||e&&e.d&&e.d.results&&"object"==typeof e.d.results)(0<t.length?t:e.d.results).forEach(function(o){var r={};if(l.queryCols?Array.isArray(l.queryCols)?l.queryCols.forEach(function(e){r[e]=p.cleanColHtml&&"string"==col.listDataType?colVal.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):colVal}):Object.keys(l.queryCols).forEach(function(i){var n=l.queryCols[i],e=[],s="";if(n.dataName&&-1<n.dataName.indexOf("/")&&o[n.dataName.split("/")[0]]&&o[n.dataName.split("/")[0]].results){if(r[i])return;s=[],o[n.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,s.push(e)})}else n.dataName&&-1<n.dataName.indexOf("/")?(n.dataName.split(",").forEach(function(e,t){var r=e.split("/");o[r[0]]&&o[r[0]].__metadata&&delete o[r[0]].__metadata,o[r[0]]&&o[r[0]].__deferred&&delete o[r[0]].__deferred;var a=null;2==r.length?((a=o[r[0]])&&"object"==typeof a&&"results"==Object.keys(a)[0]&&(o[r[0]]=a.results),s=i!=r[0]&&i!=n.dataName?o[r[0]][r[1]]:o[r[0]]):3==r.length?((a=o[r[0]][r[1]])&&"object"==typeof a&&"results"==Object.keys(a)[0]&&(o[r[0]][r[1]]=a.results),s=i!=r[0]&&i!=n.dataName?o[r[0]][r[1]][r[2]]:o[r[0]]):4==r.length?((a=o[r[0]][r[1]][r[2]])&&"object"==typeof a&&"results"==Object.keys(a)[0]&&(o[r[0]][r[1]][r[2]]=a.results),s=i!=r[0]&&i!=n.dataName?o[r[0]][r[1]][r[2]][r[3]]:o[r[0]]):4<r.length&&console.log("This is madness!!")}),"object"!=typeof s||Array.isArray(s)||0!=Object.keys(s).length||(s=[])):n.dataName&&(e=n.dataName.split("/"),s=1<e.length?o[e[0]][e[1]]:o[e[0]]);"DateTime"==n.dataType?r[i]=new Date(s):r[i]=p.cleanColHtml&&"string"==n.listDataType?s.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):s}):Object.keys(o).forEach(function(e){var t=o[e];r[e]=t}),r.__metadata&&!l.metadata&&delete r.__metadata,e.d.__next){var a={prevId:"",maxItems:""};e.d.__next.split("&").forEach(function(e,t){-1<e.indexOf("p_ID%3d")?a.prevId=e.split("&")[0].split("%3d")[2]:-1<e.indexOf("%24top=")&&(a.maxItems=e.substring(e.lastIndexOf("=")+1))}),a.prevId&&a.maxItems&&(r.__next=a)}l.spArrData.push(r)});else if((e&&e.d?e.d:e||0)&&"object"==typeof(e.d||e)&&0<Object.keys(e.d||e).length){var r={},a=e.d||e;Object.keys(a).forEach(function(e){var t=a[e];r[e]=t}),r.__metadata&&!l.metadata&&delete r.__metadata,l.spArrData.push(r)}i(l.spArrData)}).catch(function(e){(!NODEJS||p.nodeEnabled)&&"string"==typeof e&&-1<e.indexOf("(403)")&&r<=p.maxRetries?Promise.resolve().then(function(){return sprLib.renewSecurityToken()}).then(function(){var e=document&&document.getElementById("__REQUESTDIGEST")?document.getElementById("__REQUESTDIGEST").value:null;u&&console.log("err-403: token renewed"),l.headers&&l.headers["X-RequestDigest"]&&(l.headers["X-RequestDigest"]=e),r++,sprLib.rest(l)}):(r=0,t(e))})})},sprLib.site=function(s){var e={},o=s?(s+"/").replace(/\/+$/g,"/"):"";return e.info=function(){return new Promise(function(r,t){Promise.all([sprLib.rest({url:o+"_api/web",queryCols:["Id","Title","Description","Language","Created","LastItemModifiedDate","LastItemUserModifiedDate","RequestAccessEmail","SiteLogoUrl","Url","WebTemplate","AssociatedOwnerGroup/Id","AssociatedMemberGroup/Id","AssociatedVisitorGroup/Id","AssociatedOwnerGroup/OwnerTitle","AssociatedMemberGroup/OwnerTitle","AssociatedVisitorGroup/OwnerTitle","AssociatedOwnerGroup/Title","AssociatedMemberGroup/Title","AssociatedVisitorGroup/Title"],cache:!1}),sprLib.rest({url:o+"_api/site",queryCols:["Owner/Email","Owner/LoginName","Owner/Title","Owner/IsSiteAdmin"],cache:!1})]).then(function(e){var t=e[0][0];t.Owner=e[1][0].Owner,delete t.Owner.__metadata,delete t.AssociatedMemberGroup.__metadata,delete t.AssociatedOwnerGroup.__metadata,delete t.AssociatedVisitorGroup.__metadata,t.hasOwnProperty("LastItemUserModifiedDate")&&!t.LastItemUserModifiedDate&&delete t.LastItemUserModifiedDate,r(t)}).catch(function(e){t(e)})})},e.lists=function(){return new Promise(function(t,r){sprLib.rest({url:o+"_api/web/lists",queryCols:["Id","Title","Description","ItemCount","BaseType","BaseTemplate","Hidden","ImageUrl","ParentWebUrl","RootFolder/ServerRelativeUrl"]}).then(function(e){e.forEach(function(e,t){e.ServerRelativeUrl=e.RootFolder&&e.RootFolder.ServerRelativeUrl?e.RootFolder.ServerRelativeUrl:null,e.RootFolder&&delete e.RootFolder,e.BaseType=a[e.BaseType]||e.BaseType}),t(e||[])}).catch(function(e){r(e)})})},e.subsites=function(){return new Promise(function(t,r){sprLib.rest({url:o+"_api/web/webs",queryCols:{Id:{dataName:"Id",dispName:"Id"},Name:{dataName:"Title",dispName:"Subsite Name"},UrlAbs:{dataName:"Url",dispName:"Absolute URL"},UrlRel:{dataName:"ServerRelativeUrl",dispName:"Relative URL"},Created:{dataName:"Created",dispName:"Date Created"},Modified:{dataName:"LastItemModifiedDate",dispName:"Date Last Modified"},Language:{dataName:"Language",dispName:"Language"},SiteLogoUrl:{dataName:"SiteLogoUrl",dispName:"Site Logo URL"}}}).then(function(e){t(e||[])}).catch(function(e){r(e)})})},e.perms=function(){return new Promise(function(t,r){sprLib.rest({url:o+"_api/web/roleAssignments",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(e){e.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=c[e.Member.PrincipalType]||e.Member.PrincipalType}),t(e||[])}).catch(function(e){r(e)})})},e.roles=function(){return new Promise(function(t,r){sprLib.rest({url:o+"_api/web/roleDefinitions",queryCols:["Id","Name","Description","RoleTypeKind","Hidden"]}).then(function(e){t(e||[])}).catch(function(e){r(e)})})},e.groups=function(i){return new Promise(function(t,r){var a=[];if(i&&0<Object.keys(i).length&&!i.hasOwnProperty("id")&&!i.hasOwnProperty("title")&&(console.warn("Warning..: Check your options! Available `site().groups()` options are: `id`,`title`"),console.warn("Result...: Invalid filter option: All site groups will be returned"),i=null),s){var e="Member/PrincipalType eq 8";i&&i.id?e="Member/Id eq "+i.id:i&&i.title&&(e="Member/Title eq '"+i.title+"'"),sprLib.rest({url:o+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Description","Member/OwnerTitle","Member/PrincipalType","Member/AllowMembersEditMembership","Member/Users/Id","Member/Users/LoginName","Member/Users/Title"],queryFilter:e,queryLimit:p.maxRows}).then(function(e){e.forEach(function(e,t){a.push({Id:e.Member.Id,Title:e.Member.Title,Description:e.Member.Description,OwnerTitle:e.Member.OwnerTitle,PrincipalType:c[e.Member.PrincipalType]||e.Member.PrincipalType,AllowMembersEditMembership:e.Member.AllowMembersEditMembership,Users:e.Member.Users.map(function(e){return e.__metadata&&delete e.__metadata,e})})}),t(a||[])}).catch(function(e){r(e)})}else{e="";i&&i.id?e="Id eq "+i.id:i&&i.title&&(e="Title eq '"+i.title+"'"),sprLib.rest({url:o+"_api/web/SiteGroups",queryCols:["Id","Title","Description","OwnerTitle","PrincipalType","AllowMembersEditMembership","Users/Id","Users/LoginName","Users/Title"],queryFilter:e,queryLimit:p.maxRows}).then(function(e){e&&Array.isArray(e)&&(e=e.filter(function(e){return-1==e.Title.indexOf("SharingLinks")})),e.forEach(function(e,t){e.PrincipalType=c[e.PrincipalType]||e.PrincipalType}),t(e||[])}).catch(function(e){r(e)})}})},e.users=function(n){return new Promise(function(i,t){n&&0<Object.keys(n).length&&!n.hasOwnProperty("id")&&!n.hasOwnProperty("title")&&(console.warn("Warning..: Check your options! Available `site().users()` options are: `id`,`title`"),console.warn("Result...: Invalid filter option: All site users will be returned"),n=null),s?Promise.all([sprLib.rest({url:o+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Email","Member/LoginName","Member/Title","Member/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 1",queryLimit:p.maxRows}),sprLib.rest({url:o+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Users/Id","Member/Users/Email","Member/Users/LoginName","Member/Users/Title","Member/Users/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 8",queryLimit:p.maxRows})]).then(function(e){var r=[],a={};e[0].forEach(function(e){e.Member.Groups=[],(!n||n&&n.id&&n.id==e.Member.Id||n&&n.title&&n.title==e.Member.Title)&&(r.push(e.Member),a[e.Member.Id]=e.Member)}),e[1].forEach(function(t){t.Member.Users&&0<t.Member.Users.length&&t.Member.Users.forEach(function(e){e.__metadata&&delete e.__metadata,(!n||n&&n.id&&n.id==e.Id||n&&n.title&&n.title==e.Title)&&(e.Groups||(e.Groups=[]),e.Groups.push({Id:t.Member.Id,Title:t.Member.Title}),a[e.Id]?(a[e.Id].Groups||(a[e.Id].Groups=[]),a[e.Id].Groups.push({Id:t.Member.Id,Title:t.Member.Title})):(r.push(e),a[e.Id]=t.Member))})}),i(r||[])}).catch(function(e){t(e)}):sprLib.rest({url:o+"_api/web/SiteUsers",queryCols:["Id","Email","LoginName","Title","IsSiteAdmin","Groups/Id","Groups/Title"],queryFilter:"PrincipalType eq 1",queryLimit:p.maxRows}).then(function(e){var t=[];e.forEach(function(e){(!n||n&&n.id&&n.id==e.Id||n&&n.title&&n.title==e.Title)&&-1==e.Title.indexOf("spocrwl")&&e.Id<1e9&&t.push(e)}),i(t||[])}).catch(function(e){t(e)})})},e},sprLib.user=function(n){var e={},t="_api/Web",a="/CurrentUser?";return!(n&&0<Object.keys(n).length)||n.hasOwnProperty("id")||n.hasOwnProperty("email")||n.hasOwnProperty("login")||n.hasOwnProperty("title")||(console.warn("Warning: Check your options! Available `user()` options are: `id`,`email`,`login`,`title`"),console.warn("Result: Current user is being returned"),n={}),(n=n||{}).hasOwnProperty("baseUrl")&&(t=n.baseUrl.toString().replace(/\/+$/,"")+"/_api/Web"),n&&n.id?a="/siteusers?$filter=Id%20eq%20"+n.id+"&":n&&n.email?a="/siteusers?$filter=Email%20eq%20%27"+n.email+"%27&":n&&n.login?a="/siteusers?$filter=LoginName%20eq%20%27"+n.login.replace(/#/g,"%23")+"%27&":n&&n.title&&(a="/siteusers?$filter=Title%20eq%20%27"+n.title+"%27&"),a=t+a,e.info=function(){return new Promise(function(e,t){sprLib.rest({url:a+"$select=Id,Title,Email,LoginName,IsSiteAdmin,PrincipalType",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(r){var a={};(r&&Array.isArray(r)&&r[0]&&0<Object.keys(r[0]).length?Object.keys(r[0]):[]).forEach(function(e,t){a[e]=r[0][e]}),e(a)}).catch(function(e){t(e)})})},e.groups=function(){return new Promise(function(t,r){sprLib.rest({url:a+"$select=Groups/Id,Groups/Title,Groups/Description,Groups/LoginName,Groups/OwnerTitle&$expand=Groups",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(e){var r=[];(e&&e[0]&&e[0].Groups&&e[0].Groups.results?e[0].Groups.results:[]).forEach(function(e,t){r.push({Id:e.Id,Title:e.Title,Description:e.Description,OwnerTitle:e.OwnerTitle,LoginName:e.LoginName})}),t(r)}).catch(function(e){r(e)})})},e.profile=function(a){return new Promise(function(e,t){var i=Array.isArray(a)?a:"string"==typeof a?[a]:null,r=n&&n.login?encodeURIComponent(n.login):null;Promise.resolve().then(function(){if(n&&!n.login)return sprLib.user(n).info()}).then(function(e){return e&&(r=encodeURIComponent(e.LoginName)),r?sprLib.rest({url:"_api/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v='"+r+"'",type:"POST",metadata:!1}):sprLib.rest({url:"_api/SP.UserProfiles.PeopleManager/GetMyProperties",metadata:!1})}).then(function(t){var r={};if(t&&t[0]&&t[0].hasOwnProperty("GetPropertiesFor")&&e({}),t[0]&&Array.isArray(i)&&0<i.length?i.forEach(function(e){r[e]=t[0][e]||"ERROR: No such property exists in SP.UserProfiles.PeopleManager"}):t[0]?r=t[0]:u&&console.log("??? `arrProfileProps[0]` does not exist!"),Object.keys(r).forEach(function(e){r[e]&&r[e].__metadata&&delete r[e].__metadata,r[e]&&r[e].ValueType&&delete r[e].ValueType,"UserProfileProperties"==e&&(r[e]=r[e].results),r[e]&&r[e].results&&(r[e]=r[e].results)}),r.UserProfileProperties){var a={};r.UserProfileProperties.forEach(function(e){a[e.Key]=e.Value}),r.UserProfileProperties=a}e(0==Object.keys(r).length?{}:r)}).catch(function(e){t(e)})})},e},sprLib.renewSecurityToken=function(){return new Promise(function(r,t){sprLib.rest({url:"_api/contextinfo",type:"POST"}).then(function(e){var t=e&&e[0]&&e[0].GetContextWebInformation&&e[0].GetContextWebInformation.FormDigestValue?e[0].GetContextWebInformation.FormDigestValue:null;"undefined"!=typeof document&&document.getElementById("__REQUESTDIGEST")&&(document.getElementById("__REQUESTDIGEST").value=t),r(t)}).catch(function(e){t(e)})})},sprLib.nodeConfig=function(e){e=e&&"object"==typeof e?e:{},p.nodeCookie=e.cookie||"",p.nodeEnabled=void 0===e.nodeEnabled||e.nodeEnabled,p.nodeServer=e.server||""}}(),NODEJS||"undefined"==typeof window||!window.NodeList||NodeList.prototype.forEach||(NodeList.prototype.forEach=function(e,t){t=t||window;for(var r=0;r<this.length;r++)e.call(t,this[r],r,this)}),NODEJS){var https=require("https"),isElectron=require("is-electron");module.exports=sprLib}