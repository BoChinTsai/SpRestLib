var NODEJS="undefined"!=typeof module&&module.exports;if(function(){function e(e,t,r){e=e||{},t=t||"",r=r||"";var i="("+e.status+") "+t+": "+r;try{$.parseJSON(e.responseText).error.code.split(",")[0],i="("+e.status+") "+$.parseJSON(e.responseText).error.message.value}catch(t){a&&console.warn("Unable to parse jqXHR response:\n"+e.responseText)}return i}function t(){return new Promise(function(e,t){UpdateFormDigest(_spPageContextInfo.webServerRelativeUrl,10),e()})}var a=!1,r={0:"None",1:"User",2:"Distribution List",4:"Security Group",8:"SharePoint Group",15:"All"},i={baseUrl:"..",busySpinnerHtml:'<div class="sprlib-spinner"><div class="sprlib-bounce1"></div><div class="sprlib-bounce2"></div><div class="sprlib-bounce3"></div></div>',cache:!1,cleanColHtml:!0,currencyChar:"$",language:"en",maxRetries:2,maxRows:1e3,metadata:!1,nodeCookie:"",nodeEnabled:!0,nodeServer:"",retryAfter:1e3},n=/^[0-9a-f]{8}-([0-9a-f]{4}-){3}[0-9a-f]{12}$/i,s=0;this.sprLib={},sprLib.version="1.5.0-beta-20180111",sprLib.baseUrl=function(e){if("string"!=typeof e||""==e||!e)return i.baseUrl;i.baseUrl=e.replace(/\/+$/,""),a&&console.log("APP_OPTS.baseUrl = "+i.baseUrl)},sprLib.list=function(e){function t(){return new Promise(function(e,t){sprLib.rest({url:s+"?$select=ListItemEntityTypeFullName"}).then(function(a){a&&Array.isArray(a)&&1==a.length?e({type:a[0].ListItemEntityTypeFullName}):t("Invalid result!")}).catch(function(e){t(e)})})}var r={},s="_api/lists",o=$("#__REQUESTDIGEST").val();if((e=e||{}).guid&&(e.name=e.guid),e&&"string"==typeof e)s+=n.test(e)?"(guid'"+e+"')":"/getbytitle('"+e.replace(/\s/gi,"%20")+"')";else{if(!(e&&"object"==typeof e&&Object.keys(e).length>0&&e.name))return console.error("ERROR: A 'listName' or 'listGUID' is required! EX: `sprLib.list('Employees')` or `sprLib.list({ name:'Employees' })`"),console.error("ARGS:"),console.error(e),null;s=e.baseUrl?e.baseUrl.replace(/\/+$/,"")+"/_api/lists":s,s+=n.test(e.name)?"(guid'"+e.name+"')":"/getbytitle('"+e.name.replace(/\s/gi,"%20")+"')",e.requestDigest&&(o=e.requestDigest)}return r.cols=function(){return new Promise(function(e,t){sprLib.rest({url:s+"?$select=Fields&$expand=Fields",metadata:!1}).then(function(t){var a=[];(t&&t[0]&&t[0].Fields&&t[0].Fields.results?t[0].Fields.results:[]).forEach(function(e,t){e.Hidden||"Edit"==e.InternalName||"DocIcon"==e.InternalName||0==e.InternalName.indexOf("_")||a.push({dispName:e.Title,dataName:e.InternalName,dataType:e.TypeAsString,isAppend:e.AppendOnly||!1,isNumPct:e.SchemaXml.toLowerCase().indexOf('percentage="true"')>-1,isReadOnly:e.ReadOnlyField,isRequired:e.Required,isUnique:e.EnforceUniqueValues,defaultValue:e.DefaultValue||null,maxLength:e.MaxLength||null})}),e(a)}).catch(function(e){t(e)})})},r.info=function(){return new Promise(function(e,t){sprLib.rest({url:s+"?$select=Id,AllowContentTypes,BaseTemplate,BaseType,Created,Description,DraftVersionVisibility,EnableAttachments,EnableFolderCreation,EnableVersioning,ForceCheckout,Hidden,ItemCount,LastItemDeletedDate,LastItemModifiedDate,LastItemUserModifiedDate,ListItemEntityTypeFullName,Title",metadata:!1}).then(function(t){e(t&&t.length>0?t[0]:[])}).catch(function(e){t(e)})})},r.getItems=function(e){var t="";return new Promise(function(r,n){if(""!=(e=e||{})&&e!=[]||(e={}),e.queryFilter&&(e.queryFilter=e.queryFilter.replace(/\"/gi,"'")),"string"==typeof e||"number"==typeof e){var l={};l[e.toString()]={dataName:e.toString()},e={listCols:l}}else if(Array.isArray(e)){u={};e.forEach(function(e,t){var a=e.indexOf("/")>-1?e.substring(0,e.indexOf("/")):e;e&&(u[a]=u[a]?{dataName:u[a].dataName+","+e}:{dataName:e})}),e={listCols:u}}else if("string"==typeof e.listCols){d={};Object.keys(e).forEach(function(t,a){d[t]=e[t]}),e.listCols=[e.listCols];u={};e.listCols.forEach(function(e,t){var a=e.indexOf("/")>-1?e.substring(0,e.indexOf("/")):e;e&&(u[a]=u[a]?{dataName:u[a].dataName+","+e}:{dataName:e})}),d.listCols=u,e=d}else if(Array.isArray(e.listCols)){var d={};Object.keys(e).forEach(function(t,a){d[t]=e[t]});var u={};e.listCols.forEach(function(e,t){var a=e.indexOf("/")>-1?e.substring(0,e.indexOf("/")):e;e&&(u[a]=u[a]?{dataName:u[a].dataName+","+e}:{dataName:e})}),d.listCols=u,e=d}else e.listCols||(e.listCols={});e.spArrData=[],e.spObjData={},"object"==typeof e.listCols&&Object.keys(e.listCols).length>0&&$.each(e.listCols,function(t,a){a.getVersions&&(e.metadata=!0)}),Promise.resolve().then(function(){return new Promise(function(r,n){var l={url:s+"/items",type:"GET",cache:e.cache||i.cache,metadata:e.metadata||i.metadata,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":o}},d=[],u="";e.queryNext&&("object"==typeof e.queryNext&&e.queryNext.prevId&&e.queryNext.maxItems||(e.queryNext=null,console.log('ERROR: queryNext should be an object with `prevId` and `maxItems`. EX: `{"prevId":200,"maxItems":100}`'))),e.queryNext&&e.listCols&&Object.keys(e.listCols).length>0?l.url+="?%24skiptoken=Paged%3dTRUE%26p_ID%3d"+e.queryNext.prevId+"&%24select=":e.listCols&&Object.keys(e.listCols).length>0&&(l.url+="?$select="),$.each(e.listCols,function(e,t){if(t.dataName&&("="==l.url.substring(l.url.length-1)?l.url+=t.dataName:l.url+=l.url.lastIndexOf(",")==l.url.length-1?t.dataName:","+t.dataName,t.dataName.indexOf("/")>-1)){var a=t.dataName.substring(0,t.dataName.indexOf("/"));-1==d.indexOf(a)&&(d.push(a),u+=(""==u?"":",")+a)}}),u&&(l.url+=(l.url.indexOf("?")>-1?"&":"?")+"$expand="+u),e.queryFilter&&(l.url+=(l.url.indexOf("?")>-1?"&":"?")+"$filter="+(-1==e.queryFilter.indexOf("%")?encodeURI(e.queryFilter):e.queryFilter)),e.queryOrderby&&(l.url+=(l.url.indexOf("?")>-1?"&":"?")+"$orderby="+e.queryOrderby),e.queryNext?l.url+="&p_ID="+e.queryNext.prevId+"&$top="+e.queryNext.maxItems:l.url+=(l.url.indexOf("?$")>-1?"&":"?")+"$top="+(e.queryLimit?e.queryLimit:i.maxRows),sprLib.rest(l).then(function(n){if((!e.listCols||0==Object.keys(e.listCols).length)&&n.length>0){var s={};Object.keys(n[0]).forEach(function(e,t){n[0][e]&&"object"==typeof n[0][e]&&n[0][e].__deferred?a&&console.log('FYI: Skipping "select all" column: '+e):s[e]={dataName:e}}),e.listCols=s}n.forEach(function(a,r){var n={},s=0;a.__metadata&&(n.__metadata=a.__metadata,a.__metadata.uri&&(a.__metadata.uri.indexOf("/Items(")>-1&&(s=Number(a.__metadata.uri.split("/Items(").pop().replace(")",""))),!t&&a.__metadata.uri.indexOf("guid'")>-1&&(t=a.__metadata.uri.split("guid'").pop().split("')/")[0]))),a.__next&&(n.__next=a.__next),$.each(e.listCols,function(e,t){var r=[],s="";if(t.dataName&&t.dataName.indexOf("/")>-1&&a[t.dataName.split("/")[0]].results){if(n[e])return;s=[],a[t.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,s.push(e)})}else t.dataName&&t.dataName.indexOf("/")>-1?(r=t.dataName.split("/"),a[r[0]].__metadata&&delete a[r[0]].__metadata,a[r[0]].__deferred&&delete a[r[0]].__deferred,"object"!=typeof(s=e!=r[0]&&e!=t.dataName?a[r[0]][r[1]]:a[r[0]])||Array.isArray(s)||0!=Object.keys(s).length||(s=null)):t.dataName?s=a[t.dataName]:t.dataFunc&&(s=t.dataFunc(a));"DateTime"==t.dataType?n[e]=new Date(s):n[e]=i.cleanColHtml&&"string"==t.listDataType?s.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):s,t.getVersions&&(n[e]=[])}),e.spArrData.push(n),s&&(e.spObjData[s]=n)}),r()}).catch(function(e){n(e)})})}).then(function(){var a=[],i=[];$.each(e.listCols,function(e,t){t.getVersions&&(t.keyName=e,a.push(t),i.push(t.dataName))}),t&&a.length?sprLib.rest({url:"_vti_bin/owssvr.dll?Cmd=Display&List=%7B"+t+"%7D&XMLDATA=TRUE&IncludeVersions=TRUE&Query=ID%20"+i.toString().replace(/\,/g,"%20")+"%20Modified%20Editor%20&SortField=Modified&SortDir=ASC"}).then(function(t){t&&t[0]&&t[0].documentElement&&$(t[0].documentElement).find("z\\:row, row").each(function(t,r){a.forEach(function(t,a){var i=$(r).attr("ows_ID"),n="";if(e.spObjData[i]&&$(r).attr("ows_"+t.dataName)){var s=$(r).attr("ows_"+t.dataName)||"";s&&(s!=n?(e.spObjData[i][t.keyName].push({verDate:new Date($(r).attr("ows_Modified").replace(" ","T")).toISOString(),verName:$(r).attr("ows_Editor").substring($(r).attr("ows_Editor").indexOf("#")+1),verText:s}),n=s):(e.spObjData[i][t.keyName].pop(),e.spObjData[i][t.keyName].push({verDate:new Date($(r).attr("ows_Modified").replace(" ","T")).toISOString(),verName:$(r).attr("ows_Editor").substring($(r).attr("ows_Editor").indexOf("#")+1),verText:s})))}})}),r(e.spArrData)}).catch(function(e){n(e)}):r(e.spArrData)}).catch(function(e){n(e)})})},r.create=function(e){return new Promise(function(a,r){e&&!Array.isArray(e)&&"object"==typeof e&&0!=Object.keys(e).length||r("JSON data expected! Ex: `{Name:'Brent'}`");try{JSON.stringify(e)}catch(e){r("`JSON.stringify(jsonData)` failed! Send valid JSON Please. Ex: `{'Name':'Brent'}`")}e.__metadata=e.__metadata||{},delete e.__metadata.etag,delete e.__next,Promise.resolve().then(function(){return e.__metadata.type?null:t()}).then(function(t){t&&t.type&&(e.__metadata=t),sprLib.rest({type:"POST",url:s+"/items",data:JSON.stringify(e),metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":o}}).then(function(t){t&&t[0]?(e.Id=t[0].Id,e.ID=t[0].ID,e.__metadata=e.__metadata||t[0].__metadata||{},e.__metadata.etag=e.__metadata.etag||t[0].__metadata.etag):e=null,a(e)}).catch(function(e){r(e)})}).catch(function(e){r(e)})})},r.update=function(e){return new Promise(function(a,r){e&&!Array.isArray(e)&&"object"==typeof e&&0!=Object.keys(e).length||r("JSON data expected! Ex: `{Name:'Brent'}`"),e.ID||e.Id||e.iD||e.id||r("JSON data must have an `ID` value! Ex: `{Id:99}`");try{JSON.stringify(e)}catch(e){r("`JSON.stringify(jsonData)` failed! Send valid JSON Please. Ex: `{'Name':'Brent'}`")}var i=e.ID||e.Id||e.iD||e.id;delete e.ID,delete e.Id,delete e.iD,delete e.id,e.__metadata=e.__metadata||{},""!=e.__metadata.etag&&null!=e.__metadata.etag||delete e.__metadata.etag,delete e.__next,Promise.resolve().then(function(){return e.__metadata.type?null:t()}).then(function(t){t&&t.type&&(e.__metadata.type=t.type),sprLib.rest({type:"POST",url:s+"/items("+i+")",data:JSON.stringify(e),metadata:!0,headers:{"X-HTTP-Method":"MERGE",Accept:"application/json;odata=verbose","X-RequestDigest":o,"IF-MATCH":e.__metadata.etag?e.__metadata.etag:"*"}}).then(function(t){e.Id=i,e.ID=i,e.__metadata.etag&&(e.__metadata.etag='"'+(Number(e.__metadata.etag.replace(/[\'\"]+/gi,""))+1)+'"'),a(e)}).catch(function(e){r(e)})})})},r.delete=function(e){return new Promise(function(a,r){e&&!Array.isArray(e)&&"object"==typeof e&&0!=Object.keys(e).length||r("JSON data expected! Ex: `{Name:'Brent'}`"),e.ID||e.Id||e.iD||e.id||r("JSON data must have an `ID` value! Ex: `{Id:99}`");try{JSON.stringify(e)}catch(e){r("`JSON.stringify(jsonData)` failed! Send valid JSON Please. Ex: `{'Name':'Brent'}`")}var i=e.ID||e.Id||e.iD||e.id;delete e.ID,delete e.Id,delete e.iD,delete e.id,e.__metadata=e.__metadata||{},""!=e.__metadata.etag&&null!=e.__metadata.etag||delete e.__metadata.etag,delete e.__next,Promise.resolve().then(function(){return e.__metadata.type?null:t()}).then(function(t){t&&t.type&&(e.__metadata.type=t.type),sprLib.rest({type:"DELETE",url:s+"/items("+i+")",metadata:!0,headers:{"X-HTTP-Method":"MERGE",Accept:"application/json;odata=verbose","X-RequestDigest":o,"IF-MATCH":e.__metadata.etag?e.__metadata.etag:"*"}}).then(function(){a(i)}).catch(function(e){r(e)})})})},r.recycle=function(e){return new Promise(function(t,a){e&&"string"==typeof e.toString()||a("ID expected! Ex: `recycle(99)`"),sprLib.rest({type:"POST",url:s+"/items("+e.toString()+")/recycle()",metadata:!0,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":o}}).then(function(){t(Number(e))}).catch(function(e){a(e)})})},r},sprLib.rest=function(t){return new Promise(function(r,n){(t=t||{}).spArrData=[],t.cache=t.cache||i.cache,t.metadata=t.metadata||i.metadata,t.type=t.restType||t.type||"GET",t.url=(t.restUrl||t.url||i.baseUrl).replace(/\"/g,"'");var o=[],l="",d={url:t.url,type:t.type,cache:t.cache,headers:t.headers||{Accept:"application/json;odata=verbose","X-RequestDigest":t.requestDigest||$("#__REQUESTDIGEST").val()}};if(t.data&&(d.data=t.data),"POST"!=d.type||d.headers.contentType||(d.headers["content-type"]="application/json;odata=verbose"),d.url=0==t.url.toLowerCase().indexOf("http")||0==t.url.indexOf("/")?"":i.baseUrl,d.url+=(0!=t.url.toLowerCase().indexOf("http")&&0!=t.url.indexOf("/")?"/":"")+t.url,t.queryCols){if(-1==d.url.toLowerCase().indexOf("$select")&&(d.url+="?$select="),"string"==typeof t.queryCols&&(t.queryCols=[t.queryCols]),Array.isArray(t.queryCols)){var u={};t.queryCols.forEach(function(e,t){var a=e.indexOf("/")>-1?e.substring(0,e.indexOf("/")):e;u[a]=u[a]?{dataName:u[a].dataName+","+e}:{dataName:e}}),t.queryCols=u}"object"==typeof t.queryCols&&$.each(t.queryCols,function(e,t){if(t.dataName&&("="==d.url.substring(d.url.length-1)?d.url+=t.dataName:d.url+=d.url.lastIndexOf(",")==d.url.length-1?t.dataName:","+t.dataName,t.dataName.indexOf("/")>-1)){t.dataName.substring(0,t.dataName.indexOf("/"));var a=t.dataName.substring(0,t.dataName.lastIndexOf("/"));-1==o.indexOf(a)&&(o.push(a),l+=(""==l?"":",")+a)}})}(t.queryFilter||d.url.toLowerCase().indexOf("$select")>-1)&&-1==t.url.toLowerCase().indexOf("$top")&&"GET"==t.type&&(d.url+=(d.url.indexOf("?")>0?"&":"?")+"$top="+(t.queryLimit?t.queryLimit:i.maxRows)),-1==t.url.toLowerCase().indexOf("$filter")&&t.queryFilter&&(d.url+=(d.url.indexOf("?")>0?"&":"?")+"$filter="+(-1==t.queryFilter.indexOf("%")?encodeURI(t.queryFilter):t.queryFilter)),-1==t.url.toLowerCase().indexOf("$orderby")&&t.queryOrderby&&(d.url+=(d.url.indexOf("?")>0?"&":"?")+"$orderby="+t.queryOrderby),-1==t.url.toLowerCase().indexOf("$expand")&&l&&(d.url+=(d.url.indexOf("?")>0?"&":"?")+"$expand="+l),Promise.resolve().then(function(){return new Promise(function(t,a){if(NODEJS&&i.nodeEnabled){d.headers.Cookie=i.nodeCookie,delete d.headers["X-RequestDigest"];var r={hostname:i.nodeServer,path:d.url,method:d.type,headers:d.headers};https.request(r,function(e){var r="";e.setEncoding("utf8"),e.on("data",function(e){r+=e}),e.on("end",function(){r.indexOf("HTTP Error")>-1?a():r.indexOf("Microsoft.SharePoint.SPException")>-1?a(JSON.parse(r).error.message.value+"\n\nURL used: "+d.url):t(r)}),e.on("error",function(e){a(JSON.parse(r).error.message.value+"\n\nURL used: "+d.url)})}).end()}else $.ajax(d).done(function(e,a){t(e)}).fail(function(t,r,i){a(e(t,r,i)+"\n\nURL used: "+d.url)})})}).then(function(e){var a=(e="string"==typeof e&&0==e.indexOf("{")?JSON.parse(e):e)&&e.d&&!e.d.results&&"object"==typeof e.d&&Object.keys(e.d).length>0?[e.d]:[];if(a.length>0||e&&e.d&&e.d.results&&"object"==typeof e.d.results)$.each(a.length>0?a:e.d.results,function(a,r){var n={};if(t.queryCols?$.each(t.queryCols,function(e,t){var a=[],s="";if(t.dataName&&t.dataName.indexOf("/")>-1&&r[t.dataName.split("/")[0]]&&r[t.dataName.split("/")[0]].results){if(n[e])return;s=[],r[t.dataName.split("/")[0]].results.forEach(function(e,t){e.__metadata&&delete e.__metadata,s.push(e)})}else t.dataName&&t.dataName.indexOf("/")>-1?(t.dataName.split(",").forEach(function(a,i){var n=a.split("/");r[n[0]]&&r[n[0]].__metadata&&delete r[n[0]].__metadata,r[n[0]]&&r[n[0]].__deferred&&delete r[n[0]].__deferred;var o=null;2==n.length?((o=r[n[0]])&&"object"==typeof o&&"results"==Object.keys(o)[0]&&(r[n[0]]=o.results),s=e!=n[0]&&e!=t.dataName?r[n[0]][n[1]]:r[n[0]]):3==n.length?((o=r[n[0]][n[1]])&&"object"==typeof o&&"results"==Object.keys(o)[0]&&(r[n[0]][n[1]]=o.results),s=e!=n[0]&&e!=t.dataName?r[n[0]][n[1]][n[2]]:r[n[0]]):4==n.length?((o=r[n[0]][n[1]][n[2]])&&"object"==typeof o&&"results"==Object.keys(o)[0]&&(r[n[0]][n[1]][n[2]]=o.results),s=e!=n[0]&&e!=t.dataName?r[n[0]][n[1]][n[2]][n[3]]:r[n[0]]):n.length>4&&console.log("This is madness!!")}),"object"!=typeof s||Array.isArray(s)||0!=Object.keys(s).length||(s=[])):t.dataName&&(a=t.dataName.split("/"),s=a.length>1?r[a[0]][a[1]]:r[a[0]]);"DateTime"==t.dataType?n[e]=new Date(s):n[e]=i.cleanColHtml&&"string"==t.listDataType?s.replace(/<div(.|\n)*?>/gi,"").replace(/<\/div>/gi,""):s}):$.each(r,function(e,t){n[e]=t}),n.__metadata&&!t.metadata&&delete n.__metadata,e.d.__next){var s={prevId:"",maxItems:""};e.d.__next.split("&").forEach(function(e,t){e.indexOf("p_ID%3d")>-1?s.prevId=e.split("&")[0].split("%3d")[2]:e.indexOf("%24top=")>-1&&(s.maxItems=e.substring(e.lastIndexOf("=")+1))}),s.prevId&&s.maxItems&&(n.__next=s)}t.spArrData.push(n)});else if((e&&e.d?e.d:e||!1)&&"object"==typeof(e.d||e)&&Object.keys(e.d||e).length>0){var n={};$.each(e.d||e,function(e,t){n[e]=t}),n.__metadata&&!t.metadata&&delete n.__metadata,t.spArrData.push(n)}else d.url.toLowerCase().indexOf("owssvr.dll")>-1&&d.url.toLowerCase().indexOf("includeversions=true")>-1&&t.spArrData.push(e);r(t.spArrData)}).catch(function(e){(!NODEJS||i.nodeEnabled)&&"string"==typeof e&&e.indexOf("(403)")>-1&&s<=i.maxRetries?Promise.resolve().then(function(){return sprLib.renewSecurityToken()}).then(function(){a&&console.log("err-403: token renewed"),t.headers&&t.headers["X-RequestDigest"]&&(t.headers["X-RequestDigest"]=t.requestDigest||$("#__REQUESTDIGEST").val()),s++,sprLib.rest(t)}):(s=0,n(e))})})},sprLib.site=function(e){var t={},a=e?(e+"/").replace(/\/+$/g,"/"):"";return t.info=function(){return new Promise(function(e,t){Promise.all([sprLib.rest({url:a+"_api/web",queryCols:["Id","Title","Description","Language","Created","LastItemModifiedDate","RequestAccessEmail","SiteLogoUrl","Url","WebTemplate","AssociatedOwnerGroup/Id","AssociatedMemberGroup/Id","AssociatedVisitorGroup/Id","AssociatedOwnerGroup/OwnerTitle","AssociatedMemberGroup/OwnerTitle","AssociatedVisitorGroup/OwnerTitle","AssociatedOwnerGroup/Title","AssociatedMemberGroup/Title","AssociatedVisitorGroup/Title"],cache:!1}),sprLib.rest({url:a+"_api/site",queryCols:["Owner/Email","Owner/LoginName","Owner/Title","Owner/IsSiteAdmin"],cache:!1})]).then(function(t){var a=t[0][0];a.Owner=t[1][0].Owner,delete a.Owner.__metadata,delete a.AssociatedMemberGroup.__metadata,delete a.AssociatedOwnerGroup.__metadata,delete a.AssociatedVisitorGroup.__metadata,e(a)}).catch(function(e){t(e)})})},t.lists=function(){return new Promise(function(e,t){sprLib.rest({url:a+"_api/web/lists",queryCols:["Id","Title","Description","ParentWebUrl","ItemCount","Hidden","ImageUrl","BaseType","BaseTemplate","RootFolder/ServerRelativeUrl"]}).then(function(t){t.forEach(function(e,t){e.RootFolder=e.RootFolder.ServerRelativeUrl}),e(t||[])}).catch(function(e){t(e)})})},t.subsites=function(){return new Promise(function(e,t){sprLib.rest({url:a+"_api/web/webs",queryCols:{Id:{dataName:"Id",dispName:"Id"},Name:{dataName:"Title",dispName:"Subsite Name"},UrlAbs:{dataName:"Url",dispName:"Absolute URL"},UrlRel:{dataName:"ServerRelativeUrl",dispNAme:"Relative URL"},Created:{dataName:"Created",dispName:"Date Created"},Modified:{dataName:"LastItemModifiedDate",dispName:"Date Last Modified"},Language:{dataName:"Language",dispName:"Language"},SiteLogoUrl:{dataName:"SiteLogoUrl",dispName:"Site Logo URL"}}}).then(function(t){e(t||[])}).catch(function(e){t(e)})})},t.perms=function(){return new Promise(function(e,t){sprLib.rest({url:a+"_api/web/roleAssignments",queryCols:["PrincipalId","Member/PrincipalType","Member/Title","RoleDefinitionBindings/Name","RoleDefinitionBindings/Hidden"]}).then(function(t){t.forEach(function(e,t){Object.defineProperty(e,"Roles",Object.getOwnPropertyDescriptor(e,"RoleDefinitionBindings")),delete e.RoleDefinitionBindings,e.Member.PrincipalId=e.PrincipalId,delete e.PrincipalId,e.Member.PrincipalType=r[e.Member.PrincipalType]||e.Member.PrincipalType}),e(t||[])}).catch(function(e){t(e)})})},t.roles=function(){return new Promise(function(e,t){sprLib.rest({url:a+"_api/web/roleDefinitions",queryCols:["Id","Name","Description","RoleTypeKind","Hidden"]}).then(function(t){e(t||[])}).catch(function(e){t(e)})})},t.groups=function(){return new Promise(function(t,i){var n=[];if(e){var s=[];sprLib.rest({url:a+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Description","Member/OwnerTitle","Member/PrincipalType","Member/AllowMembersEditMembership"],queryFilter:"Member/PrincipalType eq 8",queryLimit:5e3}).then(function(e){e.forEach(function(e,t){n.push({Id:e.Member.Id,Title:e.Member.Title,Description:e.Member.Description,OwnerTitle:e.Member.OwnerTitle,PrincipalType:r[e.Member.PrincipalType]||e.Member.PrincipalType,AllowMembersEditMembership:e.Member.AllowMembersEditMembership,Users:[]}),s.push(sprLib.rest({url:a+"_api/web/SiteGroups/GetById("+e.Member.Id+")/Users",queryCols:["Id","LoginName","Title"],queryLimit:5e3}))}),Promise.all(s).then(function(e,a){e.forEach(function(e,t){e.forEach(function(e,a){n[t].Users.push({Id:e.Id,LoginName:e.LoginName,Title:e.Title})})}),t(n||[])})}).catch(function(e){i(e)})}else sprLib.rest({url:a+"_api/web/siteGroups",queryCols:["Id","Title","PrincipalType","Description","OwnerTitle","AllowMembersEditMembership","Users/Id","Users/Title","Users/LoginName"],queryLimit:5e3}).then(function(e){e&&Array.isArray(e)&&(e=e.filter(function(e){return-1==e.Title.indexOf("SharingLinks")})),e.forEach(function(e,t){e.PrincipalType=r[e.PrincipalType]||e.PrincipalType}),t(e||[])}).catch(function(e){i(e)})})},t.users=function(){return new Promise(function(t,r){e?Promise.all([sprLib.rest({url:a+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Email","Member/LoginName","Member/Title","Member/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 1",queryLimit:5e3}),sprLib.rest({url:a+"_api/web/RoleAssignments",queryCols:["Member/Id","Member/Title","Member/Users/Id","Member/Users/Email","Member/Users/LoginName","Member/Users/Title","Member/Users/IsSiteAdmin"],queryFilter:"Member/PrincipalType eq 8",queryLimit:5e3})]).then(function(e){var a=[],r={};e[0].forEach(function(e,t){e.Member.Groups=[],a.push(e.Member),r[e.Member.Id]=e.Member}),e[1].forEach(function(e,t){e.Member.Users&&e.Member.Users.length>0&&e.Member.Users.forEach(function(t,i){t.__metadata&&delete t.__metadata,t.Groups||(t.Groups=[]),t.Groups.push({Id:e.Member.Id,Title:e.Member.Title}),r[t.Id]?(r[t.Id].Groups||(r[t.Id].Groups=[]),r[t.Id].Groups.push({Id:e.Member.Id,Title:e.Member.Title})):(a.push(t),r[t.Id]=e.Member)})}),t(a||[])}).catch(function(e){r(e)}):sprLib.rest({url:a+"_api/web/SiteUsers",queryCols:["Id","Email","LoginName","Title","IsSiteAdmin","Groups/Id","Groups/Title"],queryFilter:"PrincipalType eq 1",queryLimit:5e3}).then(function(e){e&&Array.isArray(e)&&(e=e.filter(function(e){return-1==e.Title.indexOf("spocrwl")&&e.Id<1e9})),t(e||[])}).catch(function(e){r(e)})})},t},sprLib.user=function(e){var t={},a="_api/Web",r="/CurrentUser?";return e&&"object"==typeof e&&Object.keys(e).length>0&&e.baseUrl&&(a=e.baseUrl.toString().replace(/\/+$/,"")+"/_api/Web"),e&&e.id?r="/siteusers?$filter=Id%20eq%20"+e.id+"&":e&&e.email?r="/siteusers?$filter=Email%20eq%20%27"+e.email+"%27&":e&&e.login?r="/siteusers?$filter=LoginName%20eq%20%27"+e.login.replace(/#/g,"%23")+"%27&":e&&e.title&&(r="/siteusers?$filter=Title%20eq%20%27"+e.title+"%27&"),r=a+r,t.info=function(){return new Promise(function(e,t){sprLib.rest({url:r+"$select=Id,Title,Email,LoginName,IsSiteAdmin,PrincipalType",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(t){var a={};(t&&Array.isArray(t)&&t[0]&&Object.keys(t[0]).length>0?Object.keys(t[0]):[]).forEach(function(e,r){a[e]=t[0][e]}),e(a)}).catch(function(e){t(e)})})},t.groups=function(){return new Promise(function(e,t){sprLib.rest({url:r+"$select=Groups/Id,Groups/Title,Groups/Description,Groups/LoginName,Groups/OwnerTitle&$expand=Groups",headers:{Accept:"application/json;odata=verbose"},type:"GET",cache:!1}).then(function(t){var a=[];(t&&t[0]&&t[0].Groups&&t[0].Groups.results?t[0].Groups.results:[]).forEach(function(e,t){a.push({Id:e.Id,Title:e.Title,Description:e.Description,OwnerTitle:e.OwnerTitle,LoginName:e.LoginName})}),e(a)}).catch(function(e){t(e)})})},t},sprLib.renewSecurityToken=function(){return t()},sprLib.nodeConfig=function(e){e=e&&"object"==typeof e?e:{},i.nodeCookie=e.cookie||"",i.nodeEnabled=void 0===e.nodeEnabled||e.nodeEnabled,i.nodeServer=e.server||""}}(),NODEJS){var isElectron=require("is-electron"),$=require("jquery-node"),https=require("https");module.exports=sprLib}